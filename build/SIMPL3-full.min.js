(function(t){var G;"undefined"===typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(G={},define(function(){return G})):G="undefined"!==typeof window?window:t:G=exports;(function(p){if(!t)var t=1E-6;if(!D)var D="undefined"!==typeof Float32Array?Float32Array:Array;if(!B)var B=Math.random;var F={setMatrixArrayType:function(a){D=a}};"undefined"!==typeof p&&(p.glMatrix=F);var y={create:function(){var a=new D(2);a[0]=0;a[1]=0;return a},clone:function(a){var b=new D(2);b[0]=
a[0];b[1]=a[1];return b},fromValues:function(a,b){var d=new D(2);d[0]=a;d[1]=b;return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,d){a[0]=b;a[1]=d;return a},add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];return a}};y.sub=y.subtract;y.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];return a};y.mul=y.multiply;y.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];return a};y.div=y.divide;y.min=function(a,
b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);return a};y.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);return a};y.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;return a};y.scaleAndAdd=function(a,b,d,c){a[0]=b[0]+d[0]*c;a[1]=b[1]+d[1]*c;return a};y.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1];return Math.sqrt(d*d+c*c)};y.dist=y.distance;y.squaredDistance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1];return d*d+c*c};y.sqrDist=y.squaredDistance;y.length=function(a){var b=
a[0];a=a[1];return Math.sqrt(b*b+a*a)};y.len=y.length;y.squaredLength=function(a){var b=a[0];a=a[1];return b*b+a*a};y.sqrLen=y.squaredLength;y.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};y.normalize=function(a,b){var d=b[0],c=b[1],d=d*d+c*c;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d);return a};y.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};y.cross=function(a,b,d){b=b[0]*d[1]-b[1]*d[0];a[0]=a[1]=0;a[2]=b;return a};y.lerp=function(a,b,d,c){var e=b[0];b=b[1];a[0]=e+c*(d[0]-e);a[1]=b+c*
(d[1]-b);return a};y.random=function(a,b){b=b||1;var d=2*B()*Math.PI;a[0]=Math.cos(d)*b;a[1]=Math.sin(d)*b;return a};y.transformMat2=function(a,b,d){var c=b[0];b=b[1];a[0]=d[0]*c+d[2]*b;a[1]=d[1]*c+d[3]*b;return a};y.transformMat2d=function(a,b,d){var c=b[0];b=b[1];a[0]=d[0]*c+d[2]*b+d[4];a[1]=d[1]*c+d[3]*b+d[5];return a};y.transformMat3=function(a,b,d){var c=b[0];b=b[1];a[0]=d[0]*c+d[3]*b+d[6];a[1]=d[1]*c+d[4]*b+d[7];return a};y.transformMat4=function(a,b,d){var c=b[0];b=b[1];a[0]=d[0]*c+d[4]*b+
d[12];a[1]=d[1]*c+d[5]*b+d[13];return a};y.forEach=function(){var a=y.create();return function(b,d,c,e,f,g){d||(d=2);c||(c=0);for(e=e?Math.min(e*d+c,b.length):b.length;c<e;c+=d)a[0]=b[c],a[1]=b[c+1],f(a,a,g),b[c]=a[0],b[c+1]=a[1];return b}}();y.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};"undefined"!==typeof p&&(p.vec2=y);var w={create:function(){var a=new D(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var b=new D(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},fromValues:function(a,b,d){var c=
new D(3);c[0]=a;c[1]=b;c[2]=d;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,d,c){a[0]=b;a[1]=d;a[2]=c;return a},add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];return a}};w.sub=w.subtract;w.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];a[2]=b[2]*d[2];return a};w.mul=w.multiply;w.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];a[2]=b[2]/d[2];return a};
w.div=w.divide;w.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);a[2]=Math.min(b[2],d[2]);return a};w.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);a[2]=Math.max(b[2],d[2]);return a};w.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;return a};w.scaleAndAdd=function(a,b,d,c){a[0]=b[0]+d[0]*c;a[1]=b[1]+d[1]*c;a[2]=b[2]+d[2]*c;return a};w.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(d*d+c*c+e*e)};w.dist=w.distance;
w.squaredDistance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],e=b[2]-a[2];return d*d+c*c+e*e};w.sqrDist=w.squaredDistance;w.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};w.len=w.length;w.squaredLength=function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};w.sqrLen=w.squaredLength;w.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};w.normalize=function(a,b){var d=b[0],c=b[1],e=b[2],d=d*d+c*c+e*e;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d);
return a};w.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};w.cross=function(a,b,d){var c=b[0],e=b[1];b=b[2];var f=d[0],g=d[1];d=d[2];a[0]=e*d-b*g;a[1]=b*f-c*d;a[2]=c*g-e*f;return a};w.lerp=function(a,b,d,c){var e=b[0],f=b[1];b=b[2];a[0]=e+c*(d[0]-e);a[1]=f+c*(d[1]-f);a[2]=b+c*(d[2]-b);return a};w.random=function(a,b){b=b||1;var d=2*B()*Math.PI,c=2*B()-1,e=Math.sqrt(1-c*c)*b;a[0]=Math.cos(d)*e;a[1]=Math.sin(d)*e;a[2]=c*b;return a};w.transformMat4=function(a,b,d){var c=b[0],e=b[1];b=b[2];a[0]=
d[0]*c+d[4]*e+d[8]*b+d[12];a[1]=d[1]*c+d[5]*e+d[9]*b+d[13];a[2]=d[2]*c+d[6]*e+d[10]*b+d[14];return a};w.transformMat3=function(a,b,d){var c=b[0],e=b[1];b=b[2];a[0]=c*d[0]+e*d[3]+b*d[6];a[1]=c*d[1]+e*d[4]+b*d[7];a[2]=c*d[2]+e*d[5]+b*d[8];return a};w.transformQuat=function(a,b,d){var c=b[0],e=b[1],f=b[2];b=d[0];var g=d[1],m=d[2];d=d[3];var q=d*c+g*f-m*e,r=d*e+m*c-b*f,n=d*f+b*e-g*c,c=-b*c-g*e-m*f;a[0]=q*d+c*-b+r*-m-n*-g;a[1]=r*d+c*-g+n*-b-q*-m;a[2]=n*d+c*-m+q*-g-r*-b;return a};w.forEach=function(){var a=
w.create();return function(b,d,c,e,f,g){d||(d=3);c||(c=0);for(e=e?Math.min(e*d+c,b.length):b.length;c<e;c+=d)a[0]=b[c],a[1]=b[c+1],a[2]=b[c+2],f(a,a,g),b[c]=a[0],b[c+1]=a[1],b[c+2]=a[2];return b}}();w.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof p&&(p.vec3=w);var v={create:function(){var a=new D(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var b=new D(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},fromValues:function(a,b,d,c){var e=new D(4);
e[0]=a;e[1]=b;e[2]=d;e[3]=c;return e},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,d,c,e){a[0]=b;a[1]=d;a[2]=c;a[3]=e;return a},add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];return a}};v.sub=v.subtract;v.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];a[2]=b[2]*d[2];a[3]=b[3]*d[3];return a};v.mul=v.multiply;v.divide=function(a,
b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];a[2]=b[2]/d[2];a[3]=b[3]/d[3];return a};v.div=v.divide;v.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);a[2]=Math.min(b[2],d[2]);a[3]=Math.min(b[3],d[3]);return a};v.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);a[2]=Math.max(b[2],d[2]);a[3]=Math.max(b[3],d[3]);return a};v.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;return a};v.scaleAndAdd=function(a,b,d,c){a[0]=b[0]+d[0]*c;a[1]=b[1]+d[1]*c;
a[2]=b[2]+d[2]*c;a[3]=b[3]+d[3]*c;return a};v.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(d*d+c*c+e*e+f*f)};v.dist=v.distance;v.squaredDistance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return d*d+c*c+e*e+f*f};v.sqrDist=v.squaredDistance;v.length=function(a){var b=a[0],d=a[1],c=a[2];a=a[3];return Math.sqrt(b*b+d*d+c*c+a*a)};v.len=v.length;v.squaredLength=function(a){var b=a[0],d=a[1],c=a[2];a=a[3];return b*b+d*d+c*c+a*a};v.sqrLen=
v.squaredLength;v.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};v.normalize=function(a,b){var d=b[0],c=b[1],e=b[2],f=b[3],d=d*d+c*c+e*e+f*f;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d);return a};v.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};v.lerp=function(a,b,d,c){var e=b[0],f=b[1],g=b[2];b=b[3];a[0]=e+c*(d[0]-e);a[1]=f+c*(d[1]-f);a[2]=g+c*(d[2]-g);a[3]=b+c*(d[3]-b);return a};v.random=function(a,b){b=b||1;a[0]=B();a[1]=
B();a[2]=B();a[3]=B();v.normalize(a,a);v.scale(a,a,b);return a};v.transformMat4=function(a,b,d){var c=b[0],e=b[1],f=b[2];b=b[3];a[0]=d[0]*c+d[4]*e+d[8]*f+d[12]*b;a[1]=d[1]*c+d[5]*e+d[9]*f+d[13]*b;a[2]=d[2]*c+d[6]*e+d[10]*f+d[14]*b;a[3]=d[3]*c+d[7]*e+d[11]*f+d[15]*b;return a};v.transformQuat=function(a,b,d){var c=b[0],e=b[1],f=b[2];b=d[0];var g=d[1],m=d[2];d=d[3];var q=d*c+g*f-m*e,r=d*e+m*c-b*f,n=d*f+b*e-g*c,c=-b*c-g*e-m*f;a[0]=q*d+c*-b+r*-m-n*-g;a[1]=r*d+c*-g+n*-b-q*-m;a[2]=n*d+c*-m+q*-g-r*-b;return a};
v.forEach=function(){var a=v.create();return function(b,d,c,e,f,g){d||(d=4);c||(c=0);for(e=e?Math.min(e*d+c,b.length):b.length;c<e;c+=d)a[0]=b[c],a[1]=b[c+1],a[2]=b[c+2],a[3]=b[c+3],f(a,a,g),b[c]=a[0],b[c+1]=a[1],b[c+2]=a[2],b[c+3]=a[3];return b}}();v.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof p&&(p.vec4=v);F={create:function(){var a=new D(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},clone:function(a){var b=new D(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];
return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},invert:function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=c*k-f*e;if(!g)return null;g=1/g;a[0]=k*g;a[1]=-e*g;a[2]=-f*g;a[3]=c*g;return a},adjoint:function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a},determinant:function(a){return a[0]*
a[3]-a[2]*a[1]},multiply:function(a,b,c){var e=b[0],f=b[1],k=b[2];b=b[3];var g=c[0],m=c[1],q=c[2];c=c[3];a[0]=e*g+f*q;a[1]=e*m+f*c;a[2]=k*g+b*q;a[3]=k*m+b*c;return a}};F.mul=F.multiply;F.rotate=function(a,b,c){var e=b[0],f=b[1],k=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=e*c+f*g;a[1]=e*-g+f*c;a[2]=k*c+b*g;a[3]=k*-g+b*c;return a};F.scale=function(a,b,c){var e=b[1],f=b[2],k=b[3],g=c[0];c=c[1];a[0]=b[0]*g;a[1]=e*c;a[2]=f*g;a[3]=k*c;return a};F.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+
a[2]+", "+a[3]+")"};"undefined"!==typeof p&&(p.mat2=F);F={create:function(){var a=new D(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},clone:function(a){var b=new D(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},invert:function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=b[4],m=b[5],q=c*k-e*f;if(!q)return null;
q=1/q;a[0]=k*q;a[1]=-e*q;a[2]=-f*q;a[3]=c*q;a[4]=(f*m-k*g)*q;a[5]=(e*g-c*m)*q;return a},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=b[4];b=b[5];var q=c[0],r=c[1],n=c[2],u=c[3],x=c[4];c=c[5];a[0]=e*q+f*n;a[1]=e*r+f*u;a[2]=k*q+g*n;a[3]=k*r+g*u;a[4]=q*m+n*b+x;a[5]=r*m+u*b+c;return a}};F.mul=F.multiply;F.rotate=function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=b[4];b=b[5];var q=Math.sin(c);c=Math.cos(c);a[0]=e*c+f*q;a[1]=-e*q+f*c;a[2]=
k*c+g*q;a[3]=-k*q+c*g;a[4]=c*m+q*b;a[5]=c*b-q*m;return a};F.scale=function(a,b,c){var e=c[0];c=c[1];a[0]=b[0]*e;a[1]=b[1]*c;a[2]=b[2]*e;a[3]=b[3]*c;a[4]=b[4]*e;a[5]=b[5]*c;return a};F.translate=function(a,b,c){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4]+c[0];a[5]=b[5]+c[1];return a};F.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};"undefined"!==typeof p&&(p.mat2d=F);var f={create:function(){var a=new D(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;
a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new D(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},
transpose:function(a,b){if(a===b){var c=b[1],e=b[2],f=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=e;a[7]=f}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=b[4],m=b[5],q=b[6],r=b[7],n=b[8],u=n*g-m*r,x=-n*k+m*q,C=r*k-g*q,A=c*u+e*x+f*C;if(!A)return null;A=1/A;a[0]=u*A;a[1]=(-n*e+f*r)*A;a[2]=(m*e-f*g)*A;a[3]=x*A;a[4]=(n*c-f*q)*A;a[5]=(-m*c+f*k)*A;a[6]=C*A;a[7]=(-r*c+e*q)*A;a[8]=(g*c-e*k)*
A;return a},adjoint:function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=b[4],m=b[5],q=b[6],r=b[7],n=b[8];a[0]=g*n-m*r;a[1]=f*r-e*n;a[2]=e*m-f*g;a[3]=m*q-k*n;a[4]=c*n-f*q;a[5]=f*k-c*m;a[6]=k*r-g*q;a[7]=e*q-c*r;a[8]=c*g-e*k;return a},determinant:function(a){var b=a[3],c=a[4],e=a[5],f=a[6],k=a[7],g=a[8];return a[0]*(g*c-e*k)+a[1]*(-g*b+e*f)+a[2]*(k*b-c*f)},multiply:function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=b[4],q=b[5],r=b[6],n=b[7];b=b[8];var u=c[0],x=c[1],C=c[2],A=c[3],p=c[4],E=c[5],z=c[6],t=c[7];
c=c[8];a[0]=u*e+x*g+C*r;a[1]=u*f+x*m+C*n;a[2]=u*k+x*q+C*b;a[3]=A*e+p*g+E*r;a[4]=A*f+p*m+E*n;a[5]=A*k+p*q+E*b;a[6]=z*e+t*g+c*r;a[7]=z*f+t*m+c*n;a[8]=z*k+t*q+c*b;return a}};f.mul=f.multiply;f.translate=function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=b[4],q=b[5],r=b[6],n=b[7];b=b[8];var u=c[0];c=c[1];a[0]=e;a[1]=f;a[2]=k;a[3]=g;a[4]=m;a[5]=q;a[6]=u*e+c*g+r;a[7]=u*f+c*m+n;a[8]=u*k+c*q+b;return a};f.rotate=function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=b[4],q=b[5],r=b[6],n=b[7];b=b[8];var u=Math.sin(c);
c=Math.cos(c);a[0]=c*e+u*g;a[1]=c*f+u*m;a[2]=c*k+u*q;a[3]=c*g-u*e;a[4]=c*m-u*f;a[5]=c*q-u*k;a[6]=r;a[7]=n;a[8]=b;return a};f.scale=function(a,b,c){var e=c[0];c=c[1];a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};f.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};f.fromQuat=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=c+c,m=e+e,q=f+f,r=c*g,n=c*m,c=c*q,u=e*m,e=e*q,f=
f*q,g=k*g,m=k*m,k=k*q;a[0]=1-(u+f);a[3]=n+k;a[6]=c-m;a[1]=n-k;a[4]=1-(r+f);a[7]=e+g;a[2]=c+m;a[5]=e-g;a[8]=1-(r+u);return a};f.normalFromMat4=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=b[4],m=b[5],q=b[6],r=b[7],n=b[8],u=b[9],x=b[10],C=b[11],A=b[12],p=b[13],E=b[14],z=b[15],t=c*m-e*g,w=c*q-f*g,v=c*r-k*g,y=e*q-f*m,B=e*r-k*m,D=f*r-k*q,F=n*p-u*A,G=n*E-x*A,n=n*z-C*A,H=u*E-x*p,u=u*z-C*p,x=x*z-C*E,C=t*x-w*u+v*H+y*n-B*G+D*F;if(!C)return null;C=1/C;a[0]=(m*x-q*u+r*H)*C;a[1]=(q*n-g*x-r*G)*C;a[2]=(g*u-m*
n+r*F)*C;a[3]=(f*u-e*x-k*H)*C;a[4]=(c*x-f*n+k*G)*C;a[5]=(e*n-c*u-k*F)*C;a[6]=(p*D-E*B+z*y)*C;a[7]=(E*v-A*D-z*w)*C;a[8]=(A*B-p*v+z*t)*C;return a};f.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};"undefined"!==typeof p&&(p.mat3=f);var e={create:function(){var a=new D(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new D(16);
b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=
0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(a===b){var c=b[1],e=b[2],f=b[3],k=b[6],g=b[7],m=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=k;a[11]=b[14];a[12]=f;a[13]=g;a[14]=m}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},invert:function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=b[4],m=b[5],q=b[6],r=b[7],n=b[8],u=b[9],x=
b[10],C=b[11],A=b[12],p=b[13],E=b[14],z=b[15],t=c*m-e*g,w=c*q-f*g,v=c*r-k*g,y=e*q-f*m,B=e*r-k*m,D=f*r-k*q,F=n*p-u*A,G=n*E-x*A,H=n*z-C*A,K=u*E-x*p,J=u*z-C*p,M=x*z-C*E,I=t*M-w*J+v*K+y*H-B*G+D*F;if(!I)return null;I=1/I;a[0]=(m*M-q*J+r*K)*I;a[1]=(f*J-e*M-k*K)*I;a[2]=(p*D-E*B+z*y)*I;a[3]=(x*B-u*D-C*y)*I;a[4]=(q*H-g*M-r*G)*I;a[5]=(c*M-f*H+k*G)*I;a[6]=(E*v-A*D-z*w)*I;a[7]=(n*D-x*v+C*w)*I;a[8]=(g*J-m*H+r*F)*I;a[9]=(e*H-c*J-k*F)*I;a[10]=(A*B-p*v+z*t)*I;a[11]=(u*v-n*B-C*t)*I;a[12]=(m*G-g*K-q*F)*I;a[13]=(c*
K-e*G+f*F)*I;a[14]=(p*w-A*y-E*t)*I;a[15]=(n*y-u*w+x*t)*I;return a},adjoint:function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=b[4],m=b[5],q=b[6],r=b[7],n=b[8],u=b[9],x=b[10],C=b[11],A=b[12],p=b[13],E=b[14],z=b[15];a[0]=m*(x*z-C*E)-u*(q*z-r*E)+p*(q*C-r*x);a[1]=-(e*(x*z-C*E)-u*(f*z-k*E)+p*(f*C-k*x));a[2]=e*(q*z-r*E)-m*(f*z-k*E)+p*(f*r-k*q);a[3]=-(e*(q*C-r*x)-m*(f*C-k*x)+u*(f*r-k*q));a[4]=-(g*(x*z-C*E)-n*(q*z-r*E)+A*(q*C-r*x));a[5]=c*(x*z-C*E)-n*(f*z-k*E)+A*(f*C-k*x);a[6]=-(c*(q*z-r*E)-g*(f*z-k*E)+A*(f*
r-k*q));a[7]=c*(q*C-r*x)-g*(f*C-k*x)+n*(f*r-k*q);a[8]=g*(u*z-C*p)-n*(m*z-r*p)+A*(m*C-r*u);a[9]=-(c*(u*z-C*p)-n*(e*z-k*p)+A*(e*C-k*u));a[10]=c*(m*z-r*p)-g*(e*z-k*p)+A*(e*r-k*m);a[11]=-(c*(m*C-r*u)-g*(e*C-k*u)+n*(e*r-k*m));a[12]=-(g*(u*E-x*p)-n*(m*E-q*p)+A*(m*x-q*u));a[13]=c*(u*E-x*p)-n*(e*E-f*p)+A*(e*x-f*u);a[14]=-(c*(m*E-q*p)-g*(e*E-f*p)+A*(e*q-f*m));a[15]=c*(m*x-q*u)-g*(e*x-f*u)+n*(e*q-f*m);return a},determinant:function(a){var b=a[0],c=a[1],e=a[2],f=a[3],k=a[4],g=a[5],m=a[6],q=a[7],r=a[8],n=a[9],
u=a[10],x=a[11],C=a[12],A=a[13],p=a[14];a=a[15];return(b*g-c*k)*(u*a-x*p)-(b*m-e*k)*(n*a-x*A)+(b*q-f*k)*(n*p-u*A)+(c*m-e*g)*(r*a-x*C)-(c*q-f*g)*(r*p-u*C)+(e*q-f*m)*(r*A-n*C)},multiply:function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=b[4],q=b[5],r=b[6],n=b[7],u=b[8],x=b[9],C=b[10],A=b[11],p=b[12],E=b[13],z=b[14];b=b[15];var t=c[0],w=c[1],v=c[2],y=c[3];a[0]=t*e+w*m+v*u+y*p;a[1]=t*f+w*q+v*x+y*E;a[2]=t*k+w*r+v*C+y*z;a[3]=t*g+w*n+v*A+y*b;t=c[4];w=c[5];v=c[6];y=c[7];a[4]=t*e+w*m+v*u+y*p;a[5]=t*f+w*q+v*
x+y*E;a[6]=t*k+w*r+v*C+y*z;a[7]=t*g+w*n+v*A+y*b;t=c[8];w=c[9];v=c[10];y=c[11];a[8]=t*e+w*m+v*u+y*p;a[9]=t*f+w*q+v*x+y*E;a[10]=t*k+w*r+v*C+y*z;a[11]=t*g+w*n+v*A+y*b;t=c[12];w=c[13];v=c[14];y=c[15];a[12]=t*e+w*m+v*u+y*p;a[13]=t*f+w*q+v*x+y*E;a[14]=t*k+w*r+v*C+y*z;a[15]=t*g+w*n+v*A+y*b;return a}};e.mul=e.multiply;e.translate=function(a,b,c){var e=c[0],f=c[1];c=c[2];var k,g,m,q,r,n,u,x,C,A,p,t;b===a?(a[12]=b[0]*e+b[4]*f+b[8]*c+b[12],a[13]=b[1]*e+b[5]*f+b[9]*c+b[13],a[14]=b[2]*e+b[6]*f+b[10]*c+b[14],a[15]=
b[3]*e+b[7]*f+b[11]*c+b[15]):(k=b[0],g=b[1],m=b[2],q=b[3],r=b[4],n=b[5],u=b[6],x=b[7],C=b[8],A=b[9],p=b[10],t=b[11],a[0]=k,a[1]=g,a[2]=m,a[3]=q,a[4]=r,a[5]=n,a[6]=u,a[7]=x,a[8]=C,a[9]=A,a[10]=p,a[11]=t,a[12]=k*e+r*f+C*c+b[12],a[13]=g*e+n*f+A*c+b[13],a[14]=m*e+u*f+p*c+b[14],a[15]=q*e+x*f+t*c+b[15]);return a};e.scale=function(a,b,c){var e=c[0],f=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*f;a[5]=b[5]*f;a[6]=b[6]*f;a[7]=b[7]*f;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*
c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};e.rotate=function(a,b,c,e){var f=e[0],k=e[1];e=e[2];var g=Math.sqrt(f*f+k*k+e*e),m,q,r,n,u,x,C,A,p,E,z,w,v,y,B,D,F,G,L,H;if(Math.abs(g)<t)return null;g=1/g;f*=g;k*=g;e*=g;m=Math.sin(c);q=Math.cos(c);r=1-q;c=b[0];g=b[1];n=b[2];u=b[3];x=b[4];C=b[5];A=b[6];p=b[7];E=b[8];z=b[9];w=b[10];v=b[11];y=f*f*r+q;B=k*f*r+e*m;D=e*f*r-k*m;F=f*k*r-e*m;G=k*k*r+q;L=e*k*r+f*m;H=f*e*r+k*m;f=k*e*r-f*m;k=e*e*r+q;a[0]=c*y+x*B+E*D;a[1]=g*y+C*B+z*D;a[2]=n*y+A*B+w*
D;a[3]=u*y+p*B+v*D;a[4]=c*F+x*G+E*L;a[5]=g*F+C*G+z*L;a[6]=n*F+A*G+w*L;a[7]=u*F+p*G+v*L;a[8]=c*H+x*f+E*k;a[9]=g*H+C*f+z*k;a[10]=n*H+A*f+w*k;a[11]=u*H+p*f+v*k;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};e.rotateX=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[4],k=b[5],g=b[6],m=b[7],q=b[8],r=b[9],n=b[10],u=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=f*c+q*e;a[5]=k*c+r*e;a[6]=g*c+n*e;a[7]=m*c+u*e;a[8]=q*c-
f*e;a[9]=r*c-k*e;a[10]=n*c-g*e;a[11]=u*c-m*e;return a};e.rotateY=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[0],k=b[1],g=b[2],m=b[3],q=b[8],r=b[9],n=b[10],u=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c-q*e;a[1]=k*c-r*e;a[2]=g*c-n*e;a[3]=m*c-u*e;a[8]=f*e+q*c;a[9]=k*e+r*c;a[10]=g*e+n*c;a[11]=m*e+u*c;return a};e.rotateZ=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[0],k=b[1],g=b[2],m=b[3],q=b[4],r=b[5],n=b[6],u=
b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c+q*e;a[1]=k*c+r*e;a[2]=g*c+n*e;a[3]=m*c+u*e;a[4]=q*c-f*e;a[5]=r*c-k*e;a[6]=n*c-g*e;a[7]=u*c-m*e;return a};e.fromRotationTranslation=function(a,b,c){var e=b[0],f=b[1],k=b[2],g=b[3],m=e+e,q=f+f,r=k+k;b=e*m;var n=e*q,e=e*r,u=f*q,f=f*r,k=k*r,m=g*m,q=g*q,g=g*r;a[0]=1-(u+k);a[1]=n+g;a[2]=e-q;a[3]=0;a[4]=n-g;a[5]=1-(b+k);a[6]=f+m;a[7]=0;a[8]=e+q;a[9]=f-m;a[10]=1-(b+u);a[11]=0;a[12]=c[0];a[13]=
c[1];a[14]=c[2];a[15]=1;return a};e.fromQuat=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=c+c,m=e+e,q=f+f,r=c*g,n=c*m,c=c*q,u=e*m,e=e*q,f=f*q,g=k*g,m=k*m,k=k*q;a[0]=1-(u+f);a[1]=n+k;a[2]=c-m;a[3]=0;a[4]=n-k;a[5]=1-(r+f);a[6]=e+g;a[7]=0;a[8]=c+m;a[9]=e-g;a[10]=1-(r+u);a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.frustum=function(a,b,c,e,f,k,g){var m=1/(c-b),q=1/(f-e),r=1/(k-g);a[0]=2*k*m;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*k*q;a[6]=0;a[7]=0;a[8]=(c+b)*m;a[9]=(f+e)*q;a[10]=(g+k)*r;a[11]=-1;
a[12]=0;a[13]=0;a[14]=g*k*2*r;a[15]=0;return a};e.perspective=function(a,b,c,e,f){b=1/Math.tan(b/2);var k=1/(e-f);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(f+e)*k;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*f*e*k;a[15]=0;return a};e.ortho=function(a,b,c,e,f,k,g){var m=1/(b-c),q=1/(e-f),r=1/(k-g);a[0]=-2*m;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*q;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*r;a[11]=0;a[12]=(b+c)*m;a[13]=(f+e)*q;a[14]=(g+k)*r;a[15]=1;return a};e.lookAt=function(a,b,c,
f){var l,k,g,m,q,r,n,u,x=b[0],C=b[1];b=b[2];g=f[0];m=f[1];k=f[2];n=c[0];f=c[1];l=c[2];if(Math.abs(x-n)<t&&Math.abs(C-f)<t&&Math.abs(b-l)<t)return e.identity(a);c=x-n;f=C-f;n=b-l;u=1/Math.sqrt(c*c+f*f+n*n);c*=u;f*=u;n*=u;l=m*n-k*f;k=k*c-g*n;g=g*f-m*c;(u=Math.sqrt(l*l+k*k+g*g))?(u=1/u,l*=u,k*=u,g*=u):g=k=l=0;m=f*g-n*k;q=n*l-c*g;r=c*k-f*l;(u=Math.sqrt(m*m+q*q+r*r))?(u=1/u,m*=u,q*=u,r*=u):r=q=m=0;a[0]=l;a[1]=m;a[2]=c;a[3]=0;a[4]=k;a[5]=q;a[6]=f;a[7]=0;a[8]=g;a[9]=r;a[10]=n;a[11]=0;a[12]=-(l*x+k*C+g*b);
a[13]=-(m*x+q*C+r*b);a[14]=-(c*x+f*C+n*b);a[15]=1;return a};e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};"undefined"!==typeof p&&(p.mat4=e);var c={create:function(){var a=new D(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};c.rotationTo=function(){var a=w.create(),b=w.fromValues(1,0,0),d=w.fromValues(0,1,0);return function(e,f,k){var g=w.dot(f,k);if(-.999999>
g)return w.cross(a,b,f),1E-6>w.length(a)&&w.cross(a,d,f),w.normalize(a,a),c.setAxisAngle(e,a,Math.PI),e;if(.999999<g)return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e;w.cross(a,f,k);e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=1+g;return c.normalize(e,e)}}();c.setAxes=function(){var a=f.create();return function(b,d,e,f){a[0]=e[0];a[3]=e[1];a[6]=e[2];a[1]=f[0];a[4]=f[1];a[7]=f[2];a[2]=d[0];a[5]=d[1];a[8]=d[2];return c.normalize(b,c.fromMat3(b,a))}}();c.clone=v.clone;c.fromValues=v.fromValues;c.copy=v.copy;c.set=v.set;c.identity=
function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};c.setAxisAngle=function(a,b,c){c*=.5;var e=Math.sin(c);a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=Math.cos(c);return a};c.add=v.add;c.multiply=function(a,b,c){var e=b[0],f=b[1],k=b[2];b=b[3];var g=c[0],m=c[1],q=c[2];c=c[3];a[0]=e*c+b*g+f*q-k*m;a[1]=f*c+b*m+k*g-e*q;a[2]=k*c+b*q+e*m-f*g;a[3]=b*c-e*g-f*m-k*q;return a};c.mul=c.multiply;c.scale=v.scale;c.rotateX=function(a,b,c){c*=.5;var e=b[0],f=b[1],k=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=e*
c+b*g;a[1]=f*c+k*g;a[2]=k*c-f*g;a[3]=b*c-e*g;return a};c.rotateY=function(a,b,c){c*=.5;var e=b[0],f=b[1],k=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=e*c-k*g;a[1]=f*c+b*g;a[2]=k*c+e*g;a[3]=b*c-f*g;return a};c.rotateZ=function(a,b,c){c*=.5;var e=b[0],f=b[1],k=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=e*c+f*g;a[1]=f*c-e*g;a[2]=k*c+b*g;a[3]=b*c-k*g;return a};c.calculateW=function(a,b){var c=b[0],e=b[1],f=b[2];a[0]=c;a[1]=e;a[2]=f;a[3]=-Math.sqrt(Math.abs(1-c*c-e*e-f*f));return a};c.dot=
v.dot;c.lerp=v.lerp;c.slerp=function(a,b,c,e){var f=b[0],k=b[1],g=b[2];b=b[3];var m=c[0],q=c[1],r=c[2];c=c[3];var n,u,x;u=f*m+k*q+g*r+b*c;0>u&&(u=-u,m=-m,q=-q,r=-r,c=-c);1E-6<1-u?(n=Math.acos(u),x=Math.sin(n),u=Math.sin((1-e)*n)/x,e=Math.sin(e*n)/x):u=1-e;a[0]=u*f+e*m;a[1]=u*k+e*q;a[2]=u*g+e*r;a[3]=u*b+e*c;return a};c.invert=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],g=c*c+e*e+f*f+k*k,g=g?1/g:0;a[0]=-c*g;a[1]=-e*g;a[2]=-f*g;a[3]=k*g;return a};c.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=
-b[2];a[3]=b[3];return a};c.length=v.length;c.len=c.length;c.squaredLength=v.squaredLength;c.sqrLen=c.squaredLength;c.normalize=v.normalize;c.fromMat3=function(){var a="undefined"!==typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var e=c[0]+c[4]+c[8];if(0<e)e=Math.sqrt(e+1),b[3]=.5*e,e=.5/e,b[0]=(c[7]-c[5])*e,b[1]=(c[2]-c[6])*e,b[2]=(c[3]-c[1])*e;else{var f=0;c[4]>c[0]&&(f=1);c[8]>c[3*f+f]&&(f=2);var k=a[f],g=a[k],e=Math.sqrt(c[3*f+f]-c[3*k+k]-c[3*g+g]+1);b[f]=.5*e;e=.5/e;b[3]=
(c[3*g+k]-c[3*k+g])*e;b[k]=(c[3*k+f]+c[3*f+k])*e;b[g]=(c[3*g+f]+c[3*f+g])*e}return b}}();c.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof p&&(p.quat=c)})(G)})(this);(function(t){function G(f,e,c){this.gl=c=c||t.gl;this._context_id=c.context_id;this.handler=null;this.height=this.width=-1;this.color_textures=[];this.depth_texture=null;(f&&f.length||e)&&this.setTextures(f,e);this._old_fbo=null;this._old_viewport=new Float32Array(4)}var p=t.GL={};t.requestAnimationFrame=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||function(f){setTimeout(f,1E3/60)};p.blockable_keys={Up:!0,Down:!0,Left:!0,Right:!0};p.LEFT_MOUSE_BUTTON=1;p.RIGHT_MOUSE_BUTTON=
3;p.MIDDLE_MOUSE_BUTTON=2;p.last_context_id=0;p.BYTE=5120;p.UNSIGNED_BYTE=5121;p.SHORT=5122;p.UNSIGNED_SHORT=5123;p.INT=5124;p.UNSIGNED_INT=5125;p.FLOAT=5126;p.ZERO=0;p.ONE=1;p.SRC_COLOR=768;p.ONE_MINUS_SRC_COLOR=769;p.SRC_ALPHA=770;p.ONE_MINUS_SRC_ALPHA=771;p.DST_ALPHA=772;p.ONE_MINUS_DST_ALPHA=773;p.DST_COLOR=774;p.ONE_MINUS_DST_COLOR=775;p.SRC_ALPHA_SATURATE=776;p.CONSTANT_COLOR=32769;p.ONE_MINUS_CONSTANT_COLOR=32770;p.CONSTANT_ALPHA=32771;p.ONE_MINUS_CONSTANT_ALPHA=32772;t.DEG2RAD=.0174532925;
t.RAD2DEG=57.295779578552306;t.EPSILON=1E-6;t.isPowerOfTwo=p.isPowerOfTwo=function(f){return 0==Math.log(f)/Math.log(2)%1};t.getTime="undefined"!=typeof performance?performance.now.bind(performance):Date.now.bind(Date);p.getTime=t.getTime;t.isFunction=function(f){return!!(f&&f.constructor&&f.call&&f.apply)};t.isArray=function(f){return f&&f.constructor===Array};t.isNumber=function(f){return null!=f&&f.constructor===Number};t.cloneObject=p.cloneObject=function(f,e){if(f.constructor!==Object)throw"cloneObject only can clone pure javascript objects, not classes";
e=e||{};for(var c in f){var a=f[c];if(null===a)e[c]=null;else switch(a.constructor){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:e[c]=new a.constructor(a);break;case Boolean:case Number:case String:e[c]=a;break;case Array:e[c]=a.concat();break;case Object:e[c]=p.cloneObject(a)}}return e};t.regexMap=function(f,e,c){for(var a;null!=(a=f.exec(e));)c(a)};t.createCanvas=p.createCanvas=function(f,e){var c=document.createElement("canvas");
c.width=f;c.height=e;return c};t.cloneCanvas=p.cloneCanvas=function(f){var e=document.createElement("canvas");e.width=f.width;e.height=f.height;e.getContext("2d").drawImage(f,0,0);return e};"undefined"!=typeof Image&&(Image.prototype.getPixels=function(){var f=document.createElement("canvas");f.width=this.width;f.height=this.height;f=f.getContext("2d");f.drawImage(this,0,0);return f.getImageData(0,0,this.width,this.height).data});String.prototype.hasOwnProperty("replaceAll")||Object.defineProperty(String.prototype,
"replaceAll",{value:function(f){var e=this,c;for(c in f)e=e.split(c).join(f[c]);return e},enumerable:!1});String.prototype.hasOwnProperty("hashCode")||Object.defineProperty(String.prototype,"hashCode",{value:function(){var f=0,e,c,a;if(0==this.length)return f;e=0;for(a=this.length;e<a;++e)c=this.charCodeAt(e),f=(f<<5)-f+c,f|=0;return f},enumerable:!1});Array.prototype.hasOwnProperty("subarray")||Object.defineProperty(Array.prototype,"subarray",{value:Array.prototype.slice,enumerable:!1});t.wipeObject=
function(f){for(var e in f)f.hasOwnProperty(e)&&delete f[e]};t.extendClass=p.extendClass=function(f,e){for(var c in e)f.hasOwnProperty(c)||(f[c]=e[c]);if(e.prototype)for(c in e.prototype)e.prototype.hasOwnProperty(c)&&!f.prototype.hasOwnProperty(c)&&(e.prototype.__lookupGetter__(c)?f.prototype.__defineGetter__(c,e.prototype.__lookupGetter__(c)):f.prototype[c]=e.prototype[c],e.prototype.__lookupSetter__(c)&&f.prototype.__defineSetter__(c,e.prototype.__lookupSetter__(c)));f.hasOwnProperty("superclass")||
Object.defineProperty(f,"superclass",{get:function(){return e},enumerable:!1})};t.HttpRequest=p.request=function(f,e,c,a,b){if(e){var d=null,d=[],h;for(h in e)d.push(h+"="+e[h]);d=d.join("&");f=f+"?"+d}var l=new XMLHttpRequest;l.open("GET",f,!b);l.onload=function(){200!=this.status?(w.trigger(l,"fail",this.status),a&&a(this.status)):(w.trigger(l,"done",this.response),c&&c(this.response))};l.onerror=function(a){w.trigger(l,"fail",a)};l.send();return l};XMLHttpRequest.prototype.hasOwnProperty("done")||
Object.defineProperty(XMLHttpRequest.prototype,"done",{enumerable:!1,value:function(f){w.bind(this,"done",function(e,c){f(c)});return this}});XMLHttpRequest.prototype.hasOwnProperty("fail")||Object.defineProperty(XMLHttpRequest.prototype,"fail",{enumerable:!1,value:function(f){w.bind(this,"fail",function(e,c){f(c)});return this}});t.getFileExtension=function(f){var e=f.indexOf("?");-1!=e&&(f=f.substr(0,e));e=f.lastIndexOf(".");return-1==e?"":f.substr(e+1).toLowerCase()};t.loadFileAtlas=p.loadFileAtlas=
function(f,e,c){function a(a,b){function c(){var a=m.join("\n");f[q]=a;m.length=0;q=u.substr(1)}for(var e=a.split("\n"),f={},m=[],q="",r=0,n=e.length;r<n;r++){var u=e[r].trim();u.length&&("\\"==u[0]?q?c():q=u.substr(1):m.push(u))}q&&c();return f}var b=null;HttpRequest(f,null,function(c){c=a(c);e&&e(c);b&&b(c)},alert,c);return{done:function(a){b=a}}};t.hexColorToRGBA=function(){var f={white:[1,1,1],black:[0,0,0],gray:[.501960813999176,.501960813999176,.501960813999176],red:[1,0,0],orange:[1,.6470588445663452,
0],pink:[1,.7529411911964417,.7960784435272217],green:[0,.501960813999176,0],lime:[0,1,0],blue:[0,0,1],violet:[.9333333373069763,.5098039507865906,.9333333373069763],magenta:[1,0,1],cyan:[0,1,1],yellow:[1,1,0],brown:[.6470588445663452,.16470588743686676,.16470588743686676],silver:[.7529411911964417,.7529411911964417,.7529411911964417],gold:[1,.843137264251709,0],transparent:[0,0,0,0]};return function(e,c,a){a=void 0===a?1:a;c=c||new Float32Array(4);c[3]=a;if("string"!=typeof e)return c;var b=f[e];
if(void 0!==b)c.set(b),c[3]=3==c.length?a:c[3]*a;else{b=e.indexOf("rgba(");if(-1!=b)return e=e.substr(5),e=e.split(","),c[0]=parseInt(e[0])/255,c[1]=parseInt(e[1])/255,c[2]=parseInt(e[2])/255,c[3]=parseFloat(e[3])*a,c;c[3]=a;b=e.indexOf("rgb(");if(-1!=b)return e=e.substr(3),e=e.split(","),c[0]=parseInt(e[0])/255,c[1]=parseInt(e[1])/255,c[2]=parseInt(e[2])/255,c;e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,e){return b+b+c+c+e+e});a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);
if(!a)return c;c[0]=parseInt(a[1],16)/255;c[1]=parseInt(a[2],16)/255;c[2]=parseInt(a[3],16)/255;return c}}}();var J=function(){function f(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function e(a,b,c,e){var d=new Uint16Array(4),f=new Uint16Array(c*e),h=0,k=0,l=0,p=k=h=0,t=0,z=0,w=0,v=c/4;e/=4;for(var y=0;y<e;y++)for(var B=0;B<v;B++)l=b+4*(y*v+B),d[0]=a[l],d[1]=a[l+1],h=d[0]&31,k=d[0]&2016,p=d[0]&63488,t=d[1]&31,z=d[1]&2016,w=d[1]&63488,d[2]=5*h+3*t>>3|
5*k+3*z>>3&2016|5*p+3*w>>3&63488,d[3]=5*t+3*h>>3|5*z+3*k>>3&2016|5*w+3*p>>3&63488,h=a[l+2],k=4*y*c+4*B,f[k]=d[h&3],f[k+1]=d[h>>2&3],f[k+2]=d[h>>4&3],f[k+3]=d[h>>6&3],k+=c,f[k]=d[h>>8&3],f[k+1]=d[h>>10&3],f[k+2]=d[h>>12&3],f[k+3]=d[h>>14],h=a[l+3],k+=c,f[k]=d[h&3],f[k+1]=d[h>>2&3],f[k+2]=d[h>>4&3],f[k+3]=d[h>>6&3],k+=c,f[k]=d[h>>8&3],f[k+1]=d[h>>10&3],f[k+2]=d[h>>12&3],f[k+3]=d[h>>14];return f}function c(a){for(var b=0,c=a.length,e=0;b<c;b+=4)e=a[b],a[b]=a[b+2],a[b+2]=e}function a(a,b,d,f){var n=new Int32Array(d,
0,31),u,x,p,A,t,E,z,w,v;if(542327876!=n[0])return console.error("Invalid magic number in DDS header"),0;if(!n[20]&4)return console.error("Unsupported format, must contain a FourCC code"),0;u=n[21];switch(u){case h:x=8;p=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case l:x=16;p=b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case k:x=16;p=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:x=4,u=null,p=a.RGBA}z=1;n[2]&131072&&!1!==f&&(z=Math.max(1,n[7]));A=n[4];t=n[3];E=n[1]+4;if(n[28]&512)for(v=0;6>
v;++v)for(A=n[4],t=n[3],w=0;w<z;++w)u?(f=Math.max(4,A)/4*Math.max(4,t)/4*x,b=new Uint8Array(d,E,f),a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+v,w,p,A,t,0,b)):(a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),f=A*t*x,b=new Uint8Array(d,E,f),c(b),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+v,w,p,A,t,0,a.RGBA,a.UNSIGNED_BYTE,b)),E+=f,A*=.5,t*=.5;else if(b)for(a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),w=0;w<z;++w)u?(f=Math.max(4,A)/4*Math.max(4,t)/4*x,b=new Uint8Array(d,E,f),a.compressedTexImage2D(a.TEXTURE_2D,
w,p,A,t,0,b)):(f=A*t*x,b=new Uint8Array(d,E,f),c(b),a.texImage2D(a.TEXTURE_2D,w,p,A,t,0,p,a.UNSIGNED_BYTE,b)),E+=f,A*=.5,t*=.5;else if(u==h)b=new Uint16Array(d),d=e(b,E/2,A,t),a.texImage2D(a.TEXTURE_2D,0,a.RGB,A,t,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),f&&a.generateMipmap(a.TEXTURE_2D);else return console.error("No manual decoder for",String.fromCharCode(u&255,u>>8&255,u>>16&255,u>>24&255),"and no native support"),0;return z}function b(a,b){var d=new Int32Array(a,0,31),f,n,u,x,p,A,t,w,z,v,y;if(542327876!=
d[0])return console.error("Invalid magic number in DDS header"),0;if(!d[20]&4)return console.error("Unsupported format, must contain a FourCC code"),0;f=d[21];switch(f){case h:n=8;u="COMPRESSED_RGB_S3TC_DXT1_EXT";break;case l:n=16;u="COMPRESSED_RGBA_S3TC_DXT3_EXT";break;case k:n=16;u="COMPRESSED_RGBA_S3TC_DXT5_EXT";break;default:n=4,u="RGBA"}z=1;d[2]&131072&&!1!==loadMipmaps&&(z=Math.max(1,d[7]));x=d[4];p=d[3];t=d[1]+4;var B=[];if(d[28]&512)for(y=0;6>y;++y)for(x=d[4],p=d[3],v=0;v<z;++v)f?(A=Math.max(4,
x)/4*Math.max(4,p)/4*n,new Uint8Array(a,t,A),B.push({tex:"TEXTURE_CUBE_MAP",face:y,mipmap:v,internalFormat:u,width:x,height:p,offset:0,dataOffset:t,dataLength:A})):(A=x*p*n,w=new Uint8Array(a,t,A),c(w),B.push({tex:"TEXTURE_CUBE_MAP",face:y,mipmap:v,internalFormat:u,width:x,height:p,offset:0,type:"UNSIGNED_BYTE",dataOffset:t,dataLength:A})),t+=A,x*=.5,p*=.5;else if(b)if(f==h)w=new Uint16Array(a),d=e(w,t/2,x,p),B.push({tex:"TEXTURE_2D",mipmap:0,internalFormat:"RGB",width:x,height:p,offset:0,format:"RGB",
type:"UNSIGNED_SHORT_5_6_5",data:d});else return console.error("No manual decoder for",String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255),"and no native support"),0;else for(v=0;v<z;++v)A=Math.max(4,x)/4*Math.max(4,p)/4*n,new Uint8Array(a,t,A),B.push({tex:"TEXTURE_2D",mipmap:v,internalFormat:u,width:x,height:p,offset:0,type:"UNSIGNED_BYTE",dataOffset:t,dataLength:A}),t+=A,x*=.5,p*=.5;return B}function d(b,c,d,e,f,h){var k=new XMLHttpRequest;k.open("GET",d,!0);k.responseType="arraybuffer";k.onload=
function(){if(200==this.status){var d=new Int32Array(this.response,0,31),k=d[28]&512?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;b.bindTexture(k,e);var l=a(b,c,this.response,f);b.texParameteri(k,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(k,b.TEXTURE_MIN_FILTER,1<l?b.LINEAR_MIPMAP_LINEAR:b.LINEAR);b.bindTexture(k,null);e.texture_type=k;e.width=d[4];e.height=d[3]}h&&h(e)};k.send(null);return e}var h=f("DXT1"),l=f("DXT3"),k=f("DXT5");return{dxtToRgb565:e,uploadDDSLevels:a,loadDDSTextureEx:d,loadDDSTexture:function(a,
b,c,e){var f=a.createTexture();b=a.getExtension("WEBGL_compressed_texture_s3tc");d(a,b,c,f,!0,e);return f},loadDDSTextureFromMemoryEx:function(b,c,d,e,f){var h=new Int32Array(d,0,31),k=!!(h[28]&512),l=k?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;b.bindTexture(l,e.handler);c=a(b,c,d,f);b.texParameteri(l,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(l,b.TEXTURE_MIN_FILTER,1<c?b.LINEAR_MIPMAP_LINEAR:b.LINEAR);k&&(b.texParameteri(l,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(l,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE));
b.bindTexture(l,null);e.handler&&(e.texture_type=l,e.width=h[4],e.height=h[3]);return e},getDDSTextureFromMemoryEx:function(a){var c=new Int32Array(a,0,31),d=c[28]&512?"TEXTURE_CUBE_MAP":"TEXTURE_2D",e=b(a);return{type:d,buffers:e,data:a,width:c[4],height:c[3]}}}}();"undefined"!=typeof t&&(t.DDS=J);if("undefined"==typeof glMatrix)throw"You must include glMatrix on your project";Math.clamp=function(f,e,c){return e>f?e:c<f?c:f};vec3.ZERO=vec3.fromValues(0,0,0);vec3.FRONT=vec3.fromValues(0,0,-1);vec3.UP=
vec3.fromValues(0,1,0);vec3.RIGHT=vec3.fromValues(1,0,0);vec2.rotate=function(f,e,c){var a=e[0];e=e[1];var b=Math.cos(c);c=Math.sin(c);f[0]=a*b-e*c;f[1]=a*c+e*b;return f};vec3.zero=function(f){f[0]=f[1]=f[2]=0;return f};vec3.minValue=function(f){return f[0]<f[1]&&f[0]<f[2]?f[0]:f[1]<f[2]?f[1]:f[2]};vec3.maxValue=function(f){return f[0]>f[1]&&f[0]>f[2]?f[0]:f[1]>f[2]?f[1]:f[2]};vec3.minValue=function(f){return f[0]<f[1]&&f[0]<f[2]?f[0]:f[1]<f[2]?f[1]:f[2]};vec3.addValue=function(f,e,c){f[0]=e[0]+c;
f[1]=e[1]+c;f[2]=e[2]+c};vec3.subValue=function(f,e,c){f[0]=e[0]-c;f[1]=e[1]-c;f[2]=e[2]-c};vec3.toArray=function(f){return[f[0],f[1],f[2]]};vec3.rotateX=function(f,e,c){var a=e[1],b=e[2],d=Math.cos(c);c=Math.sin(c);f[0]=e[0];f[1]=a*d-b*c;f[2]=a*c+b*d;return f};vec3.rotateY=function(f,e,c){var a=e[0],b=e[2],d=Math.cos(c);c=Math.sin(c);f[0]=a*d-b*c;f[1]=e[1];f[2]=a*c+b*d;return f};vec3.rotateZ=function(f,e,c){var a=e[0],b=e[1],d=Math.cos(c);c=Math.sin(c);f[0]=a*d-b*c;f[1]=a*c+b*d;f[2]=e[2];return f};
vec2.perpdot=function(f,e){return f[1]*e[0]+-f[0]*e[1]};vec2.computeSignedAngle=function(f,e){return Math.atan2(vec2.perpdot(f,e),vec2.dot(f,e))};vec2.random=function(f){f[0]=Math.random();f[1]=Math.random();return f};vec3.angle=function(f,e){return Math.acos(vec3.dot(f,e))};vec3.random=function(f){f[0]=Math.random();f[1]=Math.random();f[2]=Math.random();return f};vec4.random=function(f){f[0]=Math.random();f[1]=Math.random();f[2]=Math.random();f[3]=Math.random();return f};vec3.polarToCartesian=function(f,
e){var c=e[0],a=e[1],b=e[2];f[0]=c*Math.cos(a)*Math.sin(b);f[1]=c*Math.sin(a);f[2]=c*Math.cos(a)*Math.cos(b);return f};mat4.toArray=function(f){return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]]};mat4.setUpAndOrthonormalize=function(f,e,c){e!=f&&mat4.copy(f,e);e=f.subarray(0,3);vec3.normalize(f.subarray(4,7),c);f=f.subarray(8,11);vec3.cross(e,c,f);vec3.normalize(e,e);vec3.cross(f,e,c);vec3.normalize(f,f)};mat4.multiplyVec3=function(f,e,c){var a=c[0],b=c[1];
c=c[2];f[0]=e[0]*a+e[4]*b+e[8]*c+e[12];f[1]=e[1]*a+e[5]*b+e[9]*c+e[13];f[2]=e[2]*a+e[6]*b+e[10]*c+e[14];return f};mat4.projectVec3=function(f,e,c){var a=c[0],b=c[1];c=c[2];var d=e[1]*a+e[5]*b+e[9]*c+e[13],h=e[2]*a+e[6]*b+e[10]*c+e[14],l=e[3]*a+e[7]*b+e[11]*c+e[15];f[0]=((e[0]*a+e[4]*b+e[8]*c+e[12])/l+1)/2;f[1]=(d/l+1)/2;f[2]=(h/l+1)/2;return f};vec3.project=function(f,e,c,a){a=a||gl.viewport_data;var b=e[0],d=e[1];e=e[2];var h=c[3]*b+c[7]*d+c[11]*e+c[15],l=1-((c[1]*b+c[5]*d+c[9]*e+c[13])/h+1)/2;f[0]=
((c[0]*b+c[4]*d+c[8]*e+c[12])/h+1)/2*a[2]+a[0];f[1]=l*a[3]+a[1];f[2]=h;return f};var D=mat4.create(),B=vec4.create();vec3.unproject=function(f,e,c,a){B[0]=2*(e[0]-a[0])/a[2]-1;B[1]=2*(e[1]-a[1])/a[3]-1;B[2]=2*e[2]-1;B[3]=1;if(!mat4.invert(D,c))return null;vec4.transformMat4(B,B,D);if(0===B[3])return null;f[0]=B[0]/B[3];f[1]=B[1]/B[3];f[2]=B[2]/B[3];return f};mat4.rotateVec3=function(f,e,c){var a=c[0],b=c[1];c=c[2];f[0]=e[0]*a+e[4]*b+e[8]*c;f[1]=e[1]*a+e[5]*b+e[9]*c;f[2]=e[2]*a+e[6]*b+e[10]*c;return f};
mat4.fromTranslationFrontTop=function(f,e,c,a){vec3.cross(f.subarray(0,3),c,a);f.set(a,4);f.set(c,8);f.set(e,12);return f};mat4.translationMatrix=function(f){var e=mat4.create();e[12]=f[0];e[13]=f[1];e[14]=f[2];return e};mat4.setTranslation=function(f,e){f[12]=e[0];f[13]=e[1];f[14]=e[2];return f};mat4.getTranslation=function(f,e){f[0]=e[12];f[1]=e[13];f[2]=e[14];return f};mat4.toRotationMat4=function(f,e){mat4.copy(f,e);f[12]=f[13]=f[14]=0;return f};mat4.swapRows=function(f,e,c,a){if(f!=e)return mat4.copy(f,
e),f[4*c]=e[4*a],f[4*c+1]=e[4*a+1],f[4*c+2]=e[4*a+2],f[4*c+3]=e[4*a+3],f[4*a]=e[4*c],f[4*a+1]=e[4*c+1],f[4*a+2]=e[4*c+2],f[4*a+3]=e[4*c+3],f;e=new Float32Array(matrix.subarray(4*c,5*c));matrix.set(matrix.subarray(4*a,5*a),4*c);matrix.set(e,4*a);return f};mat4.scaleAndAdd=function(f,e,c,a){f[0]=e[0]+c[0]*a;f[1]=e[1]+c[1]*a;f[2]=e[2]+c[2]*a;f[3]=e[3]+c[3]*a;f[4]=e[4]+c[4]*a;f[5]=e[5]+c[5]*a;f[6]=e[6]+c[6]*a;f[7]=e[7]+c[7]*a;f[8]=e[8]+c[8]*a;f[9]=e[9]+c[9]*a;f[10]=e[10]+c[10]*a;f[11]=e[11]+c[11]*a;f[12]=
e[12]+c[12]*a;f[13]=e[13]+c[13]*a;f[14]=e[14]+c[14]*a;f[15]=e[15]+c[15]*a;return f};quat.toEuler=function(f,e){var c=Math.atan2(2*e[1]*e[3]-2*e[0]*e[2],1-2*e[1]*e[1]-2*e[2]*e[2]),a=Math.asin(2*e[0]*e[1]+2*e[2]*e[3]),b=Math.atan2(2*e[0]*e[3]-2*e[1]*e[2],1-2*e[0]*e[0]-2*e[2]*e[2]);f||(f=vec3.create());vec3.set(f,c,a,b);return f};quat.fromEuler=function(f,e){var c=e[0],a=e[1],b=e[2],d=Math.cos(c),h=Math.cos(a),l=Math.cos(b),c=Math.sin(c),a=Math.sin(a),b=Math.sin(b),k=.5*Math.sqrt(1+d*h+d*l-c*a*b+h*l);
quat.set(f,(h*b+d*b+c*a*l)/(4*k),(c*h+c*l+d*a*b)/(4*k),(-c*b+d*a*l+a)/(4*k),k);return f};quat.fromMat4=function(f,e){var c=e[0]+e[5]+e[10];if(0<c){var a=Math.sqrt(c+1);f[3]=.5*a;a=.5/a;f[0]=(e[9]-e[6])*a;f[1]=(e[2]-e[8])*a;f[2]=(e[4]-e[1])*a}else{c=0;e[5]>e[0]&&(c=1);e[10]>e[4*c+c]&&(c=2);var b=(c+1)%3,d=(b+1)%3,a=Math.sqrt(e[4*c+c]-e[4*b+b]-e[4*d+d]+1);f[c]=.5*a;a=.5/a;f[3]=(e[4*d+b]-e[4*b+d])*a;f[b]=(e[4*b+c]+e[4*c+b])*a;f[d]=(e[4*d+c]+e[4*c+d])*a}quat.normalize(f,f)};quat.fromMat4.lookAt=function(){var f=
vec3.create();return function(e,c,a){a=vec3.dot(vec3.FRONT,c);if(1E-6>Math.abs(a- -1))return e.set(vec3.UP),e[3]=Math.PI,e;if(1E-6>Math.abs(a-1))return quat.identity(e);a=Math.acos(a);vec3.cross(f,vec3.FRONT,c);vec3.normalize(f,f);quat.setAxisAngle(e,f,a);return e}}();p.Indexer=function(){this.unique=[];this.indices=[];this.map={}};p.Indexer.prototype={add:function(f){var e=JSON.stringify(f);e in this.map||(this.map[e]=this.unique.length,this.unique.push(f));return this.map[e]}};t.Buffer=p.Buffer=
function(f,e,c,a,b){b=b||t.gl;this.buffer=null;this.target=f;this.gl=b;this.data=e;this.spacing=c||3;this.data&&this.upload(a)};p.Buffer.prototype.forEach=function(f){for(var e=this.data,c=0,a=this.spacing,b=e.length;c<b;c+=a)f(e.subarray(c,c+a),c);return this};p.Buffer.prototype.applyTransform=function(f){for(var e=this.data,c=0,a=this.spacing,b=e.length;c<b;c+=a)a=e.subarray(c,c+a),vec3.transformMat4(a,a,f);return this};p.Buffer.prototype.upload=function(f){var e=this.spacing||3,c=this.gl;if(!this.data)throw"No data supplied";
var a=this.data;if(!a.buffer)throw"Buffers must be typed arrays";if(this.buffer=this.buffer||c.createBuffer()){this.buffer.length=a.length;this.buffer.spacing=e;switch(a.constructor){case Int8Array:this.buffer.gl_type=c.BYTE;break;case Uint8ClampedArray:case Uint8Array:this.buffer.gl_type=c.UNSIGNED_BYTE;break;case Int16Array:this.buffer.gl_type=c.SHORT;break;case Uint16Array:this.buffer.gl_type=c.UNSIGNED_SHORT;break;case Int32Array:this.buffer.gl_type=c.INT;break;case Uint32Array:this.buffer.gl_type=
c.UNSIGNED_INT;break;case Float32Array:this.buffer.gl_type=c.FLOAT;break;default:throw"unsupported buffer type";}c.bindBuffer(this.target,this.buffer);c.bufferData(this.target,a,f||this.stream_type||c.STATIC_DRAW)}};p.Buffer.prototype.compile=p.Buffer.prototype.upload;p.Buffer.prototype.uploadRange=function(f,e){if(!this.data)throw"No data stored in this buffer";if(!this.data.buffer)throw"Buffers must be typed arrays";var c=new Uint8Array(this.data.buffer,f,e),a=this.gl;a.bindBuffer(this.target,this.buffer);
a.bufferSubData(this.target,f,c)};p.Buffer.prototype.clone=function(f){var e=new p.Buffer;if(f)for(var c in this)e[c]=this[c];else this.target&&(e.target=this.target),this.gl&&(e.gl=this.gl),this.spacing&&(e.spacing=this.spacing),this.data&&(e.data=new t[this.data.constructor](this.data),e.upload());return e};t.Mesh=p.Mesh=function(f,e,c,a){this.gl=a=a||t.gl;this._context_id=a.context_id;this.vertexBuffers={};this.indexBuffers={};(f||e)&&this.addBuffers(f,e);if(c)for(var b in c)this[b]=c[b]};Mesh.common_buffers=
{vertices:{spacing:3,attribute:"a_vertex"},vertices2D:{spacing:2,attribute:"a_vertex2D"},normals:{spacing:3,attribute:"a_normal"},coords:{spacing:2,attribute:"a_coord"},coords1:{spacing:2,attribute:"a_coord1"},coords2:{spacing:2,attribute:"a_coord2"},colors:{spacing:4,attribute:"a_color"},tangents:{spacing:3,attribute:"a_tangent"},bone_indices:{spacing:4,attribute:"a_bone_indices",type:Uint8Array},weights:{spacing:4,attribute:"a_weights"},extra:{spacing:1,attribute:"a_extra"},extra2:{spacing:2,attribute:"a_extra2"},
extra3:{spacing:3,attribute:"a_extra3"},extra4:{spacing:4,attribute:"a_extra4"}};Mesh.default_datatype=Float32Array;Mesh.prototype.addBuffer=function(f,e){e.target==gl.ARRAY_BUFFER?this.vertexBuffers[f]=e:this.indexBuffers[f]=e;e.attribute||(e.attribute=p.Mesh.common_buffers[f].attribute)};Mesh.prototype.addBuffers=function(f,e,c){var a=0;this.vertexBuffers.vertices&&(a=this.vertexBuffers.vertices.data.length/3);for(var b in f){var d=f[b];if(d){if(d.constructor==p.Buffer)d=d.data;else if("number"!=
typeof d[0]){for(var h=[],l=0,k=1E4;l<d.length;l+=k)h=Array.prototype.concat.apply(h,d.slice(l,l+k));d=h}h=p.Mesh.common_buffers[b];d.constructor===Array&&(l=p.Mesh.default_datatype,h&&h.type&&(l=h.type),d=new l(d));"vertices"==b&&(a=d.length/3);l=d.length/a;h&&h.spacing&&(l=h.spacing);k="a_"+b;h&&h.attribute&&(k=h.attribute);this.createVertexBuffer(b,k,l,d,c)}}if(e)for(b in e)if(d=e[b]){d.constructor==p.Buffer&&(d=d.data);if("number"!=typeof d[0])for(d=[],b=0,k=1E4;b<this.data.length;b+=k)d=Array.prototype.concat.apply(d,
this.data.slice(b,b+k));d.constructor===Array&&(l=Uint16Array,65536<a&&(l=Uint32Array),d=new l(d));this.createIndexBuffer(b,d)}};Mesh.prototype.createVertexBuffer=function(f,e,c,a,b){var d=p.Mesh.common_buffers[f];!e&&d&&(e=d.attribute);if(!e)throw"Buffer added to mesh without attribute name";!c&&d&&(c=d&&d.spacing?d.spacing:3);if(!a){a=this.getNumVertices();if(!a)throw"Cannot create an empty buffer in a mesh without vertices (vertices are needed to know the size)";a=new p.Mesh.default_datatype(a*
c)}if(!a.buffer)throw"Buffer data MUST be typed array";c=this.vertexBuffers[f]=new p.Buffer(gl.ARRAY_BUFFER,a,c,b,this.gl);c.name=f;c.attribute=e;return c};Mesh.prototype.removeVertexBuffer=function(f){this.vertexBuffers[f]&&delete this.vertexBuffers[f]};Mesh.prototype.getVertexBuffer=function(f){return this.vertexBuffers[f]};Mesh.prototype.createIndexBuffer=function(f,e,c){return this.indexBuffers[f]=new p.Buffer(gl.ELEMENT_ARRAY_BUFFER,e,0,c,this.gl)};Mesh.prototype.getBuffer=function(f){return this.vertexBuffers[f]};
Mesh.prototype.getIndexBuffer=function(f){return this.indexBuffers[f]};Mesh.prototype.upload=function(f){for(var e in this.vertexBuffers){var c=this.vertexBuffers[e];c.upload(f)}for(var a in this.indexBuffers)c=this.indexBuffers[a],c.upload()};Mesh.prototype.compile=Mesh.prototype.upload;Mesh.prototype.deleteBuffers=function(){for(var f in this.vertexBuffers){var e=this.vertexBuffers[f];this.gl.deleteBuffer(e.buffer);delete this.vertexBuffers[f]}for(f in this.indexBuffers)e=this.indexBuffers[f],this.gl.deleteBuffer(e.buffer),
delete this.vertexBuffers[f]};Mesh.prototype.bindBuffers=function(f){for(var e in this.vertexBuffers){var c=this.vertexBuffers[e],a=f.attributes[c.attribute||e];null!=a&&c.buffer&&(gl.bindBuffer(gl.ARRAY_BUFFER,c.buffer),gl.enableVertexAttribArray(a),gl.vertexAttribPointer(a,c.buffer.spacing,c.buffer.gl_type,!1,0,0))}};Mesh.prototype.unbindBuffers=function(f){for(var e in this.vertexBuffers){var c=this.vertexBuffers[e],a=c.attribute||e;null!=f.attributes[a]&&c.buffer&&gl.disableVertexAttribArray(f.attributes[a])}};
Mesh.prototype.clone=function(f){f=f||t.gl;var e={},c={},a;for(a in this.vertexBuffers){var b=this.vertexBuffers[a];e[a]=new b.data.constructor(b.data)}for(a in this.indexBuffers)b=this.indexBuffers[a],c[a]=new b.data.constructor(b.data);return new p.Mesh(e,c,void 0,f)};Mesh.prototype.cloneShared=function(f){f=f||t.gl;return new p.Mesh(this.vertexBuffers,this.indexBuffers,void 0,f)};Mesh.prototype.toObject=function(){var f={},e={},c;for(c in this.vertexBuffers){var a=this.vertexBuffers[c];f[c]={spacing:a.spacing,
data:new a.data.constructor(a.data)}}for(c in this.indexBuffers)a=this.indexBuffers[c],e[c]={data:new a.data.constructor(a.data)};return{vertexBuffers:f,indexBuffers:e}};Mesh.prototype.generateMetadata=function(){var f={},e=this.vertexBuffers.vertices.data,c=this.indexBuffers.triangles.data;f.vertices=e.length/3;f.faces=c?c.length/3:e.length/9;f.indexed=!!this.metadata.faces;this.metadata=f};Mesh.prototype.toJSON=function(){return""};Mesh.prototype.computeWireframe=function(){var f=this.indexBuffers.triangles,
e=this.vertexBuffers.vertices.data.length/3;if(f){for(var c=f.data,a=new p.Indexer,f=0;f<c.length;f+=3)for(var b=c.subarray(f,f+3),d=0;d<b.length;d++){var h=b[d],l=b[(d+1)%b.length];a.add([Math.min(h,l),Math.max(h,l)])}c=a.unique;a=65536<e?new Uint32Array(2*c.length):new Uint16Array(2*c.length);f=0;for(e=c.length;f<e;++f)a.set(c[f],2*f)}else for(f=e/3,a=65536<e?new Uint32Array(6*f):new Uint16Array(6*f),f=0;f<e;f+=3)a[2*f]=f,a[2*f+1]=f+1,a[2*f+2]=f+1,a[2*f+3]=f+2,a[2*f+4]=f+2,a[2*f+5]=f;this.createIndexBuffer("wireframe",
a);return this};Mesh.prototype.flipNormals=function(f){var e=this.vertexBuffers.normals;if(e){for(var c=e.data,a=c.length,b=0;b<a;++b)c[b]*=-1;e.upload(f);this.indexBuffers.triangles||this.computeIndices();e=this.indexBuffers.triangles;c=e.data;a=c.length;for(b=0;b<a;b+=3){var d=c[b];c[b]=c[b+1];c[b+1]=d}e.upload(f)}};Mesh.prototype.computeIndices=function(){var f=[],e=[],c=[],a=[],b=this.vertexBuffers.normals,d=this.vertexBuffers.coords,h=this.vertexBuffers.vertices.data,l=null;b&&(l=b.data);b=null;
d&&(b=d.data);for(var d={},k=h.length/3,g=0;g<k;++g){var m=h.subarray(3*g,3*(g+1)),q=1E3*m[0]|0,r=0,n=d[q];if(n)for(var u=n.length;r<u;r++)if(.01>vec3.sqrDist(m,f[n[r]])){a.push(r);break}n&&r!=u||(f.push(m),d[q]?d[q].push(r):d[q]=[r],l&&e.push(l.subarray(3*g,3*(g+1))),b&&c.push(b.subarray(2*g,2*(g+1))),a.push(r))}this.vertexBuffers={};this.createVertexBuffer("vertices",p.Mesh.common_buffers.vertices.attribute,3,linearizeArray(f));l&&this.createVertexBuffer("normals",p.Mesh.common_buffers.normals.attribute,
3,linearizeArray(e));b&&this.createVertexBuffer("coords",p.Mesh.common_buffers.coords.attribute,2,linearizeArray(c));this.createIndexBuffer("triangles",a)};Mesh.prototype.computeNormals=function(f){var e=this.vertexBuffers.vertices.data,c=new Float32Array(e.length),a=null;this.indexBuffers.triangles&&(a=this.indexBuffers.triangles.data);for(var b=vec3.create(),d=vec3.create(),h,l,k,g,m,q,r=a?a.length:e.length,n=0;n<r;n+=3)a?(h=a[n],l=a[n+1],k=a[n+2],g=e.subarray(3*h,3*h+3),m=e.subarray(3*l,3*l+3),
q=e.subarray(3*k,3*k+3),h=c.subarray(3*h,3*h+3),l=c.subarray(3*l,3*l+3),k=c.subarray(3*k,3*k+3)):(g=e.subarray(3*n,3*n+3),m=e.subarray(3*n+3,3*n+6),q=e.subarray(3*n+6,3*n+9),h=c.subarray(3*n,3*n+3),l=c.subarray(3*n+3,3*n+6),k=c.subarray(3*n+6,3*n+9)),vec3.sub(b,m,g),vec3.sub(d,q,g),vec3.cross(b,b,d),vec3.normalize(b,b),vec3.add(h,h,b),vec3.add(l,l,b),vec3.add(k,k,b);if(a)for(n=0,r=c.length;n<r;n+=3)e=c.subarray(n,n+3),vec3.normalize(e,e);if(r=this.vertexBuffers.normals)r.data=c,r.upload(f);else return this.createVertexBuffer("normals",
p.Mesh.common_buffers.normals.attribute,3,c);return r};Mesh.prototype.computeTangents=function(){var f=this.vertexBuffers.vertices.data,e=this.vertexBuffers.normals.data,c=this.vertexBuffers.coords.data,a=this.indexBuffers.triangles.data;if(f&&e&&c){var b=f.length/3,d=new Float32Array(4*b),h=new Float32Array(6*b),b=h.subarray(3*b),l,k,g=vec3.create(),m=vec3.create(),q=vec3.create(),r=vec3.create();l=0;for(k=a.length;l<k;l+=3){var n=a[l],u=a[l+1],x=a[l+2],p=f.subarray(3*n,3*n+3),A=f.subarray(3*u,3*
u+3),t=f.subarray(3*x,3*x+3),w=c.subarray(2*n,2*n+2),z=c.subarray(2*u,2*u+2),v=c.subarray(2*x,2*x+2),y=A[0]-p[0],B=t[0]-p[0],D=A[1]-p[1],F=t[1]-p[1],A=A[2]-p[2],p=t[2]-p[2],t=z[0]-w[0],G=v[0]-w[0],z=z[1]-w[1],w=v[1]-w[1],v=t*w-G*z,v=1E-9>Math.abs(v)?0:1/v;vec3.copy(g,[(w*y-z*B)*v,(w*D-z*F)*v,(w*A-z*p)*v]);vec3.copy(m,[(t*B-G*y)*v,(t*F-G*D)*v,(t*p-G*A)*v]);vec3.add(h.subarray(3*n,3*n+3),h.subarray(3*n,3*n+3),g);vec3.add(h.subarray(3*u,3*u+3),h.subarray(3*u,3*u+3),g);vec3.add(h.subarray(3*x,3*x+3),
h.subarray(3*x,3*x+3),g);vec3.add(b.subarray(3*n,3*n+3),b.subarray(3*n,3*n+3),m);vec3.add(b.subarray(3*u,3*u+3),b.subarray(3*u,3*u+3),m);vec3.add(b.subarray(3*x,3*x+3),b.subarray(3*x,3*x+3),m)}l=0;for(k=f.length;l<k;l+=3)f=e.subarray(l,l+3),c=h.subarray(l,l+3),vec3.subtract(q,c,vec3.scale(q,f,vec3.dot(f,c))),vec3.normalize(q,q),f=0>vec3.dot(vec3.cross(r,f,c),b.subarray(l,l+3))?-1:1,d.set([q[0],q[1],q[2],f],l/3*4);this.createVertexBuffer("tangents",Mesh.common_buffers.tangents.attribute,4,d)}};Mesh.prototype.getNumVertices=
function(){var f=this.vertexBuffers.vertices;return f?f.data.length/f.spacing:0};Mesh.computeBounding=function(f,e){if(f){for(var c=vec3.clone(f.subarray(0,3)),a=vec3.clone(f.subarray(0,3)),b,d=3;d<f.length;d+=3)b=f.subarray(d,d+3),vec3.min(c,b,c),vec3.max(a,b,a);c=vec3.add(vec3.create(),c,a);vec3.scale(c,c,.5);a=vec3.subtract(vec3.create(),a,c);return BBox.setCenterHalfsize(e||BBox.create(),c,a)}};Mesh.prototype.getBoundingBox=function(){this.bounding||this.updateBounding();return this.bounding};
Mesh.prototype.updateBounding=function(){var f=this.vertexBuffers.vertices.data;f&&(this.bounding=p.Mesh.computeBounding(f,this.bounding))};Mesh.prototype.setBounding=function(f,e){this.bounding=BBox.setCenterHalfsize(this.bounding||BBox.create(),f,e)};Mesh.prototype.freeData=function(){for(var f in this.vertexBuffers)this.vertexBuffers[f].data=null,delete this[this.vertexBuffers[f].name];for(var e in this.indexBuffers)this.indexBuffers[e].data=null,delete this[this.indexBuffers[e].name]};Mesh.prototype.configure=
function(f,e){var c={},a={};e=e||{};for(var b in f)f[b]&&("indices"==b||"lines"==b||"wireframe"==b||"triangles"==b?a[b]=f[b]:p.Mesh.common_buffers[b]?c[b]=f[b]:e[b]=f[b]);this.addBuffers(c,a);for(a in e)this[a]=e[a]};Mesh.prototype.totalMemory=function(){var f=0,e;for(e in this.vertexBuffers)f+=this.vertexBuffers[e].data.buffer.byteLength;for(e in this.indexBuffers)f+=this.indexBuffers[e].data.buffer.byteLength;return f};Mesh.load=function(f,e,c){e=e||{};c=c||new p.Mesh;c.configure(f,e);return c};
Mesh.mergeMeshes=function(f,e){function c(a,b,c,d){for(c=b+c;b<c;b+=3){var e=a.subarray(b,b+3);vec3.transformMat4(e,e,d)}}function a(a,b,c,d){for(c=b+c;b<c;b+=2){var e=a.subarray(b,b+2);vec2.transformMat3(e,e,d)}}function b(a,b,c,d){for(c=b+c;b<c;++b)a[b]+=d}e=e||{};for(var d={},h={},l={},k=[],g=0,m=0;m<f.length;++m){var q=f[m],r=q.mesh;k.push(g);var g=g+r.vertexBuffers.vertices.data.length/3,n;for(n in r.vertexBuffers)d[n]=d[n]?d[n]+r.vertexBuffers[n].data.length:r.vertexBuffers[n].data.length;for(n in r.indexBuffers)h[n]=
h[n]?h[n]+r.indexBuffers[n].data.length:r.indexBuffers[n].data.length}for(n in d)m=e[n],null===m?delete d[n]:(m||(m=Float32Array),d[n]=new m(d[n]),l[n]=0);for(n in h)h[n]=new Uint32Array(h[n]),l[n]=0;for(m=0;m<f.length;++m){q=f[m];r=q.mesh;for(n in r.vertexBuffers)d[n]&&(d[n].set(r.vertexBuffers[n].data,l[n]),q[n+"_matrix"]&&(g=q[n+"_matrix"],16==g.length?c(d[n],l[n],r.vertexBuffers[n].data.length,g):9==g.length&&a(d[n],l[n],r.vertexBuffers[n].data.length,g)),l[n]+=r.vertexBuffers[n].data.length);
for(n in r.indexBuffers)h[n].set(r.indexBuffers[n].data,l[n]),b(h[n],l[n],r.indexBuffers[n].data.length,k[m]),l[n]+=r.indexBuffers[n].data.length}return"undefined"!=typeof gl?new p.Mesh(d,h):{vertexBuffers:d,indexBuffers:h}};Mesh.parsers={};Mesh.encoders={};Mesh.fromURL=function(f,e,c){c=c||t.gl;var a=new p.Mesh(void 0,void 0,void 0,c);a.ready=!1;HttpRequest(f,null,function(b){var c=f.lastIndexOf("."),c=f.substr(c+1);a.parse(b,c);delete a.ready;e&&e(a,f)},function(a){e&&e(null)});return a};Mesh.prototype.parse=
function(f,e){e=e.toLowerCase();var c=p.Mesh.parsers[e];if(c)return c.call(null,f,{mesh:this});throw"GL.Mesh.parse: no parser found for format "+e;};Mesh.prototype.encode=function(f,e){f=f.toLowerCase();var c=p.Mesh.encoders[f];if(c)return c.call(null,this,e);throw"GL.Mesh.encode: no encoder found for format "+f;};Mesh.getScreenQuad=function(f){f=f||t.gl;var e=f.meshes[":screen_quad"];if(e)return e;var e=new Float32Array([0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,1,1,0]),c=new Float32Array([0,0,1,1,0,1,0,0,1,
0,1,1]),e=new p.Mesh({vertices:e,coords:c},void 0,void 0,f);return f.meshes[":screen_quad"]=e};Mesh.plane=function(f){f=f||{};f.triangles=[];var e=f.detailX||f.detail||1,c=f.detailY||f.detail||1,a=f.width||f.size||1,b=f.height||f.size||1,d=f.xz,a=.5*a,b=.5*b;f=[];var h=[],l=[],k=[],g=vec3.fromValues(0,0,1);d&&g.set([0,1,0]);for(var m=0;m<=c;m++)for(var q=m/c,r=0;r<=e;r++){var n=r/e;d?h.push((2*n-1)*a,0,-(2*q-1)*b):h.push((2*n-1)*a,(2*q-1)*b,0);l&&l.push(n,q);k&&k.push(g[0],g[1],g[2]);r<e&&m<c&&(n=
r+m*(e+1),d?(f.push(n+1,n+e+1,n),f.push(n+1,n+e+2,n+e+1)):(f.push(n,n+1,n+e+1),f.push(n+e+1,n+1,n+e+2)))}e=BBox.fromCenterHalfsize([0,0,0],d?[a,0,b]:[a,b,0]);return p.Mesh.load({vertices:h,normals:k,coords:l,triangles:f},{bounding:e})};Mesh.plane2D=function(f){var e=new Float32Array([-1,1,1,-1,1,1,-1,1,-1,-1,1,-1]),c=new Float32Array([0,1,1,0,1,1,0,1,0,0,1,0]);if(f&&f.size){f=.5*f.size;for(var a=0;a<e.length;++a)e[a]*=f}return new p.Mesh({vertices2D:e,coords:c})};Mesh.point=function(f){return new p.Mesh({vertices:[0,
0,0]})};Mesh.cube=function(f){f=f||{};var e=.5*(f.size||1),c={};c.vertices=new Float32Array([-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1]);for(var a=0,b=c.vertices.length;a<b;++a)c.vertices[a]*=e;c.normals=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,
0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]);c.coords=new Float32Array([0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]);f.wireframe&&(c.wireframe=new Uint16Array([0,2,2,5,5,4,4,0,6,7,7,10,10,11,11,6,0,6,2,7,5,10,4,11]));f.bounding=BBox.fromCenterHalfsize([0,0,0],[e,
e,e]);return Mesh.load(c,f)};Mesh.box=function(f){f=f||{};var e=f.sizex||1,c=f.sizey||1,a=f.sizez||1,e=.5*e,c=.5*c,a=.5*a,b={};b.vertices=new Float32Array([-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1]);for(var d=0,h=b.vertices.length;d<h;d+=3)b.vertices[d]*=e,b.vertices[d+1]*=
c,b.vertices[d+2]*=a;b.normals=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]);b.coords=new Float32Array([0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]);f.wireframe&&(b.wireframe=new Uint16Array([0,
2,2,5,5,4,4,0,6,7,7,10,10,11,11,6,0,6,2,7,5,10,4,11]));f.bounding=BBox.fromCenterHalfsize([0,0,0],[e,c,a]);return Mesh.load(b,f)};Mesh.circle=function(f){f=f||{};var e=f.size||f.radius||1,c=Math.ceil(f.slices||24),a=f.xz||!1,b=f.empty||!1;3>c&&(c=3);var d=2*Math.PI/c,h=vec3.create(),l=vec3.create(),k=vec3.fromValues(0,0,1),g=vec2.fromValues(.5,.5),m=vec2.create();a&&k.set([0,1,0]);var q=a?2:1,r=new Float32Array(3*(c+1)),n=new Float32Array(3*(c+1)),u=new Float32Array(2*(c+1)),p=null;r.set(h,0);n.set(k,
0);u.set(g,0);for(h=g=p=0;h<c;++h)p=Math.sin(d*h),g=Math.cos(d*h),l[0]=p*e,l[q]=g*e,m[0]=.5*p+.5,m[1]=.5*g+.5,r.set(l,3*h+3),n.set(k,3*h+3),u.set(m,2*h+2);if(b)r=r.subarray(3),n=r.subarray(3),u=r.subarray(2),p=null;else{p=new Uint16Array(3*c);b=2;d=1;a&&(b=1,d=2);for(h=0;h<c-1;++h)p[3*h]=0,p[3*h+1]=h+b,p[3*h+2]=h+d;p[3*h]=0;a?(p[3*h+1]=h+1,p[3*h+2]=1):(p[3*h+1]=1,p[3*h+2]=h+1)}f.bounding=BBox.fromCenterHalfsize([0,0,0],a?[e,0,e]:[e,e,0]);e={vertices:r,normals:n,coords:u,triangles:p};if(f.wireframe){a=
new Uint16Array(2*c);for(h=0;h<c;h++)a[2*h]=h,a[2*h+1]=h+1;a[0]=c;e.wireframe=a}return Mesh.load(e,f)};Mesh.cylinder=function(f){f=f||{};for(var e=f.radius||f.size||1,c=f.height||f.size||2,a=f.subdivisions||64,b=new Float32Array(36*a),d=new Float32Array(36*a),h=new Float32Array(24*a),l=2*Math.PI/a,k=null,g=0;g<a;++g){var m=g*l,k=[Math.sin(m),0,Math.cos(m)];b.set([k[0]*e,.5*c,k[2]*e],18*g);d.set(k,18*g);h.set([g/a,1],12*g);k=[Math.sin(m),0,Math.cos(m)];b.set([k[0]*e,-.5*c,k[2]*e],18*g+3);d.set(k,18*
g+3);h.set([g/a,0],12*g+2);k=[Math.sin(m+l),0,Math.cos(m+l)];b.set([k[0]*e,-.5*c,k[2]*e],18*g+6);d.set(k,18*g+6);h.set([(g+1)/a,0],12*g+4);k=[Math.sin(m+l),0,Math.cos(m+l)];b.set([k[0]*e,.5*c,k[2]*e],18*g+9);d.set(k,18*g+9);h.set([(g+1)/a,1],12*g+6);k=[Math.sin(m),0,Math.cos(m)];b.set([k[0]*e,.5*c,k[2]*e],18*g+12);d.set(k,18*g+12);h.set([g/a,1],12*g+8);k=[Math.sin(m+l),0,Math.cos(m+l)];b.set([k[0]*e,-.5*c,k[2]*e],18*g+15);d.set(k,18*g+15);h.set([(g+1)/a,0],12*g+10)}var k=18*g,q=12*g;if(!1===f.caps)b=
b.subarray(0,k),d=d.subarray(0,k),h=h.subarray(0,q);else for(var r=vec3.fromValues(0,.5*c,0),n=vec3.fromValues(0,-.5*c,0),u=vec3.fromValues(0,1,0),p=vec3.fromValues(0,-1,0),g=0;g<a;++g){var m=g*l,t=vec3.fromValues(Math.sin(m),0,Math.cos(m)),m=vec3.fromValues(Math.sin(m+l),0,Math.cos(m+l));b.set([t[0]*e,.5*c,t[2]*e],k+18*g);d.set(u,k+18*g);h.set([.5*-t[0]+.5,.5*t[2]+.5],q+12*g);b.set([m[0]*e,.5*c,m[2]*e],k+18*g+3);d.set(u,k+18*g+3);h.set([.5*-m[0]+.5,.5*m[2]+.5],q+12*g+2);b.set(r,k+18*g+6);d.set(u,
k+18*g+6);h.set([.5,.5],q+12*g+4);b.set([m[0]*e,-.5*c,m[2]*e],k+18*g+9);d.set(p,k+18*g+9);h.set([.5*m[0]+.5,.5*m[2]+.5],q+12*g+6);b.set([t[0]*e,-.5*c,t[2]*e],k+18*g+12);d.set(p,k+18*g+12);h.set([.5*t[0]+.5,.5*t[2]+.5],q+12*g+8);b.set(n,k+18*g+15);d.set(p,k+18*g+15);h.set([.5,.5],q+12*g+10)}a={vertices:b,normals:d,coords:h};f.bounding=BBox.fromCenterHalfsize([0,0,0],[e,.5*c,e]);return Mesh.load(a,f)};Mesh.sphere=function(f){f=f||{};for(var e=f.radius||f.size||1,c=f.lat||f.subdivisions||16,a=f["long"]||
f.subdivisions||16,b=new Float32Array((c+1)*(a+1)*3),d=new Float32Array((c+1)*(a+1)*3),h=new Float32Array((c+1)*(a+1)*2),l=new Uint16Array(c*a*6),k=f.hemi?.5*Math.PI:Math.PI,g=0,m=0,q=0;q<=c;q++)for(var r=q*k/c,n=Math.sin(r),u=Math.cos(r),r=0;r<=a;r++){var p=2*r*Math.PI/a,t=Math.cos(p)*n,A=u,p=Math.sin(p)*n,w=1-r/a,v=1-q/c;b.set([e*t,e*A,e*p],g);d.set([t,A,p],g);h.set([w,v],m);g+=3;m+=2}for(q=g=0;q<c;q++)for(r=0;r<a;r++)k=q*(a+1)+r,m=k+a+1,l.set([m,k,k+1],g),l.set([m+1,m,k+1],g+3),g+=6;b={vertices:b,
normals:d,coords:h,triangles:l};if(f.wireframe){d=new Uint16Array(a*c*4);for(g=h=0;g<c;g++){for(l=0;l<a;l++)d[h]=g*(a+1)+l,d[h+1]=g*(a+1)+l+1,h+=2;d[h-2*a]=g*(a+1)+l}for(g=0;g<a;g++)for(l=0;l<c;l++)d[h]=l*(a+1)+g,d[h+1]=(l+1)*(a+1)+g,h+=2;b.wireframe=d}f.bounding=f.hemi?BBox.fromCenterHalfsize([0,.5*e,0],[e,.5*e,e],e):BBox.fromCenterHalfsize([0,0,0],[e,e,e],e);return Mesh.load(b,f)};Mesh.grid=function(f){f=f||{};var e=f.lines||11;0>e&&(e=1);var c=f.size||10;f=new Float32Array(12*e);for(var a=.5*c,
b=0,d=-a,c=c/(e-1),h=0;h<e;h++)f[b]=d,f[b+2]=-a,f[b+3]=d,f[b+5]=a,f[b+6]=a,f[b+8]=d,f[b+9]=-a,f[b+11]=d,d+=c,b+=12;return new p.Mesh({vertices:f})};Mesh.icosahedron=function(f){function e(a,b){var e=k[a]<k[b]?k[a]+":"+k[b]:k[b]+":"+k[a],f=u[e];if(f)return f;f=d.length/3;d.push(.5*(d[3*k[a]]+d[3*k[b]]),.5*(d[3*k[a]+1]+d[3*k[b]+1]),.5*(d[3*k[a]+2]+d[3*k[b]+2]));var g=Math.sqrt(d[3*f]*d[3*f]+d[3*f+1]*d[3*f+1]+d[3*f+2]*d[3*f+2]),m=d[3*f]/g,n=d[3*f+1]/g,r=d[3*f+2]/g;h.push(m,n,r);l.push(Math.atan2(m,r)/
Math.PI*.5,Math.acos(n)/Math.PI);d[3*f]*=c/g;d[3*f+1]*=c/g;d[3*f+2]*=c/g;return u[e]=f}f=f||{};var c=f.radius||f.size||1,a=void 0===f.subdivisions?0:f.subdivisions;6<a&&(a=6);for(var b=(1+Math.sqrt(5))/2,d=[-1,b,0,1,b,0,-1,-b,0,1,-b,0,0,-1,b,0,1,b,0,-1,-b,0,1,-b,b,0,-1,b,0,1,-b,0,-1,-b,0,1],h=[],l=[],k=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],b=d.length,g=0;g<b;g+=3){var m=Math.sqrt(d[g]*d[g]+d[g+1]*d[g+1]+
d[g+2]*d[g+2]),q=d[g]/m,r=d[g+1]/m,n=d[g+2]/m;h.push(q,r,n);l.push(Math.atan2(q,n),Math.acos(r));d[g]*=c/m;d[g+1]*=c/m;d[g+2]*=c/m}for(var u={},m=0;m<a;++m){q=[];b=k.length;for(g=0;g<b;g+=3){var r=e(g,g+1),n=e(g+1,g+2),x=e(g+2,g);q.push(k[g],r,x);q.push(k[g+1],n,r);q.push(k[g+2],x,n);q.push(r,n,x)}k=q}f.bounding=BBox.fromCenterHalfsize([0,0,0],[c,c,c],c);return new p.Mesh.load({vertices:d,coords:l,normals:h,triangles:k},f)};t.Texture=p.Texture=function e(c,a,b,d){b=b||{};this.gl=d=d||t.gl;this._context_id=
d.context_id;c=parseInt(c);a=parseInt(a);this.handler=d.createTexture();this.width=c;this.height=a;this.format=b.format||d.RGBA;this.type=b.type||d.UNSIGNED_BYTE;this.texture_type=b.texture_type||d.TEXTURE_2D;this.magFilter=b.magFilter||b.filter||d.LINEAR;this.minFilter=b.minFilter||b.filter||d.LINEAR;this.wrapS=b.wrap||b.wrapS||d.CLAMP_TO_EDGE;this.wrapT=b.wrap||b.wrapT||d.CLAMP_TO_EDGE;e.MAX_TEXTURE_IMAGE_UNITS||(e.MAX_TEXTURE_IMAGE_UNITS=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS));this.has_mipmaps=
!1;if(this.format==d.DEPTH_COMPONENT&&!d.extensions.WEBGL_depth_texture)throw"Depth Texture not supported";if(this.type==d.FLOAT&&!d.extensions.OES_texture_float)throw"Float Texture not supported";if(this.type==d.HALF_FLOAT_OES&&!d.extensions.OES_texture_half_float)throw"Half Float Texture not supported";if(!((this.minFilter==d.NEAREST||this.minFilter==d.LINEAR)&&this.wrapS==d.CLAMP_TO_EDGE&&this.wrapT==d.CLAMP_TO_EDGE||isPowerOfTwo(this.width)&&isPowerOfTwo(this.height)))if(b.ignore_pot)this.minFilter=
this.magFilter=d.LINEAR,this.wrapS=this.wrapT=d.CLAMP_TO_EDGE;else throw"Cannot use texture-wrap or mipmaps in Non-Power-of-Two textures";c&&a&&(d.activeTexture(d.TEXTURE0+e.MAX_TEXTURE_IMAGE_UNITS-1),d.bindTexture(this.texture_type,this.handler),d.texParameteri(this.texture_type,d.TEXTURE_MAG_FILTER,this.magFilter),d.texParameteri(this.texture_type,d.TEXTURE_MIN_FILTER,this.minFilter),d.texParameteri(this.texture_type,d.TEXTURE_WRAP_S,this.wrapS),d.texParameteri(this.texture_type,d.TEXTURE_WRAP_T,
this.wrapT),b.anisotropic&&d.extensions.EXT_texture_filter_anisotropic&&d.texParameterf(d.TEXTURE_2D,d.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.anisotropic),this.texture_type==d.TEXTURE_2D?((b=b.pixel_data)&&!b.buffer&&(b=new (this.type==d.FLOAT?Float32Array:Uint8Array)(b)),d.texImage2D(d.TEXTURE_2D,0,this.format,c,a,0,this.format,this.type,b||null)):this.texture_type==d.TEXTURE_CUBE_MAP&&(d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X,0,this.format,this.width,this.height,
0,this.format,this.type,null),d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this.format,this.width,this.height,0,this.format,this.type,null),d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this.format,this.width,this.height,0,this.format,this.type,null),d.texImage2D(d.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this.format,this.width,this.height,0,this.format,this.type,null),d.texImage2D(d.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this.format,this.width,this.height,0,this.format,this.type,null),d.texImage2D(d.TEXTURE_CUBE_MAP_NEGATIVE_Z,
0,this.format,this.width,this.height,0,this.format,this.type,null)),d.bindTexture(this.texture_type,null),d.activeTexture(d.TEXTURE0))};Texture.framebuffer=null;Texture.renderbuffer=null;Texture.loading_color=new Uint8Array([0,0,0,0]);Texture.use_renderbuffer_pool=!0;Texture.prototype.getProperties=function(){return{width:this.width,height:this.height,type:this.type,format:this.format,texture_type:this.texture_type,magFilter:this.magFilter,minFilter:this.minFilter,wrapS:this.wrapS,wrapT:this.wrapT}};
Texture.prototype.toJSON=function(){return""};Texture.isDepthSupported=function(){return null!=gl.extensions.WEBGL_depth_texture};Texture.prototype.bind=function(e){void 0==e&&(e=0);var c=this.gl;c.activeTexture(c.TEXTURE0+e);c.bindTexture(this.texture_type,this.handler);return e};Texture.prototype.unbind=function(e){void 0===e&&(e=0);var c=this.gl;c.activeTexture(c.TEXTURE0+e);c.bindTexture(this.texture_type,null)};Texture.prototype.setParameter=function(e,c){this.gl.texParameteri(this.texture_type,
e,c)};Texture.setUploadOptions=function(e,c){c=c||t.gl;e?(c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!e.premultiply_alpha),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!e.no_flip)):(c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0));c.pixelStorei(c.UNPACK_ALIGNMENT,1)};Texture.prototype.uploadImage=function(e,c){this.bind();var a=this.gl;Texture.setUploadOptions(c,a);try{a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,this.type,e),this.width=e.videoWidth||
e.width,this.height=e.videoHeight||e.height}catch(b){if("file:"==location.protocol)throw'image not loaded for security reasons (serve this page over "http://" instead)';throw"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";}this.minFilter&&this.minFilter!=a.NEAREST&&this.minFilter!=a.LINEAR&&(a.generateMipmap(this.texture_type),this.has_mipmaps=!0);a.bindTexture(this.texture_type,null)};Texture.prototype.uploadData=
function(e,c){var a=this.gl;this.bind();Texture.setUploadOptions(c,a);a.texImage2D(this.texture_type,0,this.format,this.width,this.height,0,this.format,this.type,e);this.minFilter&&this.minFilter!=a.NEAREST&&this.minFilter!=a.LINEAR&&(a.generateMipmap(texture.texture_type),this.has_mipmaps=!0);a.bindTexture(this.texture_type,null)};Texture.cubemap_camera_parameters=[{type:"posX",dir:vec3.fromValues(1,0,0),up:vec3.fromValues(0,-1,0)},{type:"negX",dir:vec3.fromValues(-1,0,0),up:vec3.fromValues(0,-1,
0)},{type:"posY",dir:vec3.fromValues(0,1,0),up:vec3.fromValues(0,0,1)},{type:"negY",dir:vec3.fromValues(0,-1,0),up:vec3.fromValues(0,0,-1)},{type:"posZ",dir:vec3.fromValues(0,0,1),up:vec3.fromValues(0,-1,0)},{type:"negZ",dir:vec3.fromValues(0,0,-1),up:vec3.fromValues(0,-1,0)}];Texture.prototype.drawTo=function(e,c){function a(){6E4<=p.getTime()-this.time?(console.log("Buffer cleared"),b.deleteRenderbuffer(b._renderbuffers_pool[g]),delete b._renderbuffers_pool[g]):setTimeout(a.bind(this),6E4)}var b=
this.gl;if(this.format==b.DEPTH_COMPONENT)throw"cannot use drawTo in depth textures, use Texture.drawToColorAndDepth";var d=b.getViewport(),h=p.getTime(),l=b._framebuffer=b._framebuffer||b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,l);var k=null;if(Texture.use_renderbuffer_pool){b._renderbuffers_pool||(b._renderbuffers_pool={});var g=this.width+":"+this.height;b._renderbuffers_pool[g]?(k=b._renderbuffers_pool[g],k.time=h,b.bindRenderbuffer(b.RENDERBUFFER,k)):(b._renderbuffers_pool[g]=k=b.createRenderbuffer(),
k.time=h,k.width=this.width,k.height=this.height,b.bindRenderbuffer(b.RENDERBUFFER,k),setTimeout(a.bind(k),6E4))}else k=b._renderbuffer=b._renderbuffer||b.createRenderbuffer(),k.width=this.width,k.height=this.height,b.bindRenderbuffer(b.RENDERBUFFER,k);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,this.width,this.height);b.viewport(0,0,this.width,this.height);b._current_texture_drawto=this;b._current_fbo_color=l;b._current_fbo_depth=k;if(this.texture_type==b.TEXTURE_2D)b.framebufferTexture2D(b.FRAMEBUFFER,
b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.handler,0),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,k),e(this,c);else if(this.texture_type==b.TEXTURE_CUBE_MAP)for(h=0;6>h;h++)b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+h,this.handler,0),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,k),e(this,h,c);b._current_texture_drawto=null;b._current_fbo_color=null;b._current_fbo_depth=null;b.bindFramebuffer(b.FRAMEBUFFER,
null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.viewport(d[0],d[1],d[2],d[3]);return this};Texture.drawTo=function(e,c,a){for(var b=-1,d=-1,h=null,l=0;l<e.length;l++){var k=e[l];if(-1==b)b=k.width;else if(b!=k.width)throw"Cannot use Texture.drawTo if textures have different dimensions";if(-1==d)d=k.height;else if(d!=k.height)throw"Cannot use Texture.drawTo if textures have different dimensions";if(null==h)h=k.type;else if(h!=k.type)throw"Cannot use Texture.drawTo if textures have different data type, all must have the same type";
}h=gl.getViewport();gl._framebuffer=gl._framebuffer||gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,gl._framebuffer);gl.viewport(0,0,b,d);var g=gl.extensions.WEBGL_draw_buffers;if(!g&&1<e.length)throw"Rendering to several textures not supported";l=null;a||(l=gl._renderbuffer=gl._renderbuffer||gl.createRenderbuffer(),l.width=b,l.height=d,gl.bindRenderbuffer(gl.RENDERBUFFER,l));a?gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,a.handler,0):(gl.renderbufferStorage(gl.RENDERBUFFER,
gl.DEPTH_COMPONENT16,b,d),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,l));a=[];for(l=0;l<e.length;l++)k=e[l],gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+l,gl.TEXTURE_2D,k.handler,0),a.push(gl.COLOR_ATTACHMENT0+l);1<e.length&&g.drawBuffersWEBGL(a);e=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(e!==gl.FRAMEBUFFER_COMPLETE)throw"FBO not complete: "+e;c();gl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.viewport(h[0],h[1],h[2],h[3])};Texture.drawToColorAndDepth=
function(e,c,a){var b=e.gl;if(c.width!=e.width||c.height!=e.height)throw"Different size between color texture and depth texture";var d=b.getViewport();b._framebuffer=b._framebuffer||b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,b._framebuffer);b.viewport(0,0,e.width,e.height);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,e.handler,0);b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,c.handler,0);a();b.bindFramebuffer(b.FRAMEBUFFER,null);b.viewport(d[0],
d[1],d[2],d[3])};Texture.prototype.copyTo=function(e,c){var a=this.gl,b=a.getParameter(a.FRAMEBUFFER_BINDING),d=a.getViewport(),h=a.__copy_fbo=a.__copy_fbo||a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,h);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e.handler,0);a.viewport(0,0,e.width,e.height);a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.toViewport(c);a.setViewport(d);a.bindFramebuffer(a.FRAMEBUFFER,b);e.minFilter&&e.minFilter!=a.NEAREST&&e.minFilter!=a.LINEAR&&
(e.bind(),a.generateMipmap(e.texture_type),e.has_mipmaps=!0);a.bindTexture(e.texture_type,null);return this};Texture.prototype.toViewport=function(e,c){e=e||Shader.getScreenShader();var a=Mesh.getScreenQuad();this.bind(0);c&&e.uniforms(c);e.draw(a,gl.TRIANGLES)};Texture.prototype.fill=function(e){var c=gl.getParameter(gl.COLOR_CLEAR_VALUE);gl.clearColor(e[0],e[1],e[2],e[3]);this.drawTo(function(){gl.clear(gl.COLOR_BUFFER_BIT)});gl.clearColor(c[0],c[1],c[2],c[3])};Texture.prototype.renderQuad=function(){var e=
mat3.create(),c=vec2.create(),a=vec2.create(),b=vec4.fromValues(1,1,1,1);return function(d,h,l,k,g,m){c[0]=d;c[1]=h;a[0]=l;a[1]=k;g=g||Shader.getQuadShader(this.gl);d=Mesh.getScreenQuad(this.gl);this.bind(0);g.uniforms({u_texture:0,u_position:c,u_color:b,u_size:a,u_viewport:gl.viewport_data.subarray(2,4),u_transform:e});m&&g.uniforms(m);g.draw(d,gl.TRIANGLES)}}();Texture.prototype.applyBlur=function(e,c,a,b,d){var h=this,l=this.gl,k=p.Shader.getBlurShader();b||(b=new p.Texture(this.width,this.height,
this.getProperties()));e/=this.width;c/=this.height;l.disable(l.DEPTH_TEST);l.disable(l.BLEND);b.drawTo(function(){h.toViewport(k,{u_intensity:a,u_offset:[0,c]})});(d||this).drawTo(function(){b.toViewport(k,{u_intensity:a,u_offset:[e,0]})});return b};Texture.fromURL=function(e,c,a,b){b=b||t.gl;c=c||{};var d=c.texture||new p.Texture(1,1,c,b);64>e.length&&(d.url=e);d.bind();Texture.setUploadOptions(c);var h=c.temp_color||Texture.loading_color,h=c.type==b.FLOAT?new Float32Array(h):new Uint8Array(h);
b.texImage2D(b.TEXTURE_2D,0,d.format,d.width,d.height,0,d.format,d.type,h);b.bindTexture(d.texture_type,null);d.ready=!1;if(-1!=e.toLowerCase().indexOf(".dds")){var h=b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBGL_compressed_texture_s3tc"),l=new p.Texture(0,0,c,b);J.loadDDSTextureEx(b,h,e,l.handler,!0,function(b){d.texture_type=b.texture_type;d.handler=b;delete d.ready;a&&a(d,e)})}else b=new Image,b.src=e,b.onload=function(){c.texture=d;p.Texture.fromImage(this,c);delete d.ready;
a&&a(d,e)},b.onerror=function(){a&&a(null)};return d};Texture.fromImage=function(e,c){c=c||{};var a=c.texture||new p.Texture(e.width,e.height,c);a.bind();a.uploadImage(e,c);p.isPowerOfTwo(a.width)&&p.isPowerOfTwo(a.height)&&c.minFilter&&c.minFilter!=gl.NEAREST&&c.minFilter!=gl.LINEAR&&(a.bind(),gl.generateMipmap(a.texture_type),a.has_mipmaps=!0);gl.bindTexture(a.texture_type,null);c.keep_image&&(a.img=e);return a};Texture.fromVideo=function(e,c){c=c||{};var a=c.texture||new p.Texture(e.videoWidth,
e.videoHeight,c);a.bind();a.uploadImage(e,c);c.minFilter&&c.minFilter!=gl.NEAREST&&c.minFilter!=gl.LINEAR&&(a.bind(),gl.generateMipmap(a.texture_type),a.has_mipmaps=!0);gl.bindTexture(a.texture_type,null);return a};Texture.fromTexture=function(e,c){c=c||{};var a=new p.Texture(e.width,e.height,c);e.copyTo(a);return a};Texture.fromMemory=function(e,c,a,b){b=b||{};var d=b.texture||new p.Texture(e,c,b);Texture.setUploadOptions(b);d.bind();try{gl.texImage2D(gl.TEXTURE_2D,0,d.format,e,c,0,d.format,d.type,
a)}catch(h){if("file:"==location.protocol)throw'image not loaded for security reasons (serve this page over "http://" instead)';throw"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";}b.minFilter&&b.minFilter!=gl.NEAREST&&b.minFilter!=gl.LINEAR&&(gl.generateMipmap(gl.TEXTURE_2D),d.has_mipmaps=!0);gl.bindTexture(d.texture_type,null);return d};Texture.fromDDSInMemory=function(e,c){c=c||{};var a=c.texture||new p.Texture(0,
0,c);p.Texture.setUploadOptions(c);a.bind();var b=gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBGL_compressed_texture_s3tc");J.loadDDSTextureFromMemoryEx(gl,b,e,a,!0);gl.bindTexture(a.texture_type,null);return a};Texture.fromShader=function(e,c,a,b){b=b||{};e=new p.Texture(e,c,b);e.drawTo(function(){gl.disable(gl.BLEND);gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);var b=Mesh.getScreenQuad();a.draw(b)});return e};Texture.cubemapFromImages=function(e,c){c=c||{};
if(6!=e.length)throw"missing images to create cubemap";var a=e[0].width,b=e[0].height;c.texture_type=gl.TEXTURE_CUBE_MAP;a=c.texture||new Texture(a,b,c);Texture.setUploadOptions(c);a.bind();try{for(b=0;6>b;b++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+b,0,a.format,a.format,a.type,e[b])}catch(d){if("file:"==location.protocol)throw'image not loaded for security reasons (serve this page over "http://" instead)';throw"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";
}c.minFilter&&c.minFilter!=gl.NEAREST&&c.minFilter!=gl.LINEAR&&(gl.generateMipmap(gl.TEXTURE_CUBE_MAP),a.has_mipmaps=!0);a.unbind();return a};Texture.cubemapFromImage=function(e,c){c=c||{};if(e.width!=e.height/6&&0!=e.height%6&&!c.faces)return console.error("Cubemap image not valid, only 1x6 (vertical) or 6x3 (cross) formats. Check size:",e.width,e.height),null;var a=e.width,b=e.height;void 0!==c.is_cross?(c.faces=Texture.generateCubemapCrossFacesInfo(e.width,c.is_cross),a=b=e.width/4):c.faces?(a=
c.width||c.faces[0].width,b=c.height||c.faces[0].height):b/=6;if(a!=b)return console.log("Texture not valid, width and height for every face must be square"),null;var d=a;c.no_flip=!0;for(var h=[],l=0;6>l;l++){var k=createCanvas(d,d),g=k.getContext("2d");c.faces?g.drawImage(e,c.faces[l].x,c.faces[l].y,c.faces[l].width||d,c.faces[l].height||d,0,0,d,d):g.drawImage(e,0,b*l,a,b,0,0,d,d);h.push(k)}a=Texture.cubemapFromImages(h,c);c.keep_image&&(a.img=e);return a};Texture.generateCubemapCrossFacesInfo=
function(e,c){void 0===c&&(c=1);var a=e/4;return[{x:2*a,y:a,width:a,height:a},{x:0,y:a,width:a,height:a},{x:c*a,y:0,width:a,height:a},{x:c*a,y:2*a,width:a,height:a},{x:a,y:a,width:a,height:a},{x:3*a,y:a,width:a,height:a}]};Texture.cubemapFromURL=function(e,c,a){c=c||{};c.texture_type=gl.TEXTURE_CUBE_MAP;var b=c.texture||new p.Texture(1,1,c);b.bind();Texture.setUploadOptions(c);for(var d=c.temp_color||[0,0,0,255],d=c.type==gl.FLOAT?new Float32Array(d):new Uint8Array(d),h=0;6>h;h++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+
h,0,b.format,1,1,0,b.format,b.type,d);gl.bindTexture(b.texture_type,null);b.ready=!1;d=new Image;d.src=e;d.onload=function(){c.texture=b;(b=p.Texture.cubemapFromImage(this,c))&&delete b.ready;a&&a(b)};return b};Texture.prototype.getPixels=function(e,c){var a=this.gl,b=a.getViewport();e=e||this.type;var d=a.createFramebuffer(),h=a.createRenderbuffer();if(this.format==a.DEPTH_COMPONENT)throw"cannot use getPixels in depth textures";a.bindFramebuffer(a.FRAMEBUFFER,d);a.bindRenderbuffer(a.RENDERBUFFER,
h);h.width=this.width;h.height=this.height;a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height);a.viewport(0,0,this.width,this.height);if(this.texture_type!=a.TEXTURE_2D)throw"getPixels only work with texture2D";a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.handler,0);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,h);d=this.format==a.RGB?3:4;c&&(d=4);h=null;h=e==a.UNSIGNED_BYTE?new Uint8Array(this.width*this.height*
d):new Float32Array(this.width*this.height*d);a.readPixels(0,0,this.width,this.height,c?a.RGBA:this.format,e,h);a.bindFramebuffer(a.FRAMEBUFFER,a._current_fbo_color);a.bindRenderbuffer(a.RENDERBUFFER,a._current_fbo_depth);a.viewport(b[0],b[1],b[2],b[3]);return h};Texture.prototype.toCanvas=function(e,c,a){a=a||8192;var b=this.gl;if(this.texture_type!=b.TEXTURE_2D)return null;var d=Math.min(this.width,a);a=Math.min(this.height,a);e=e||createCanvas(d,a);e.width!=d&&(e.width=d);e.height!=a&&(e.height=
a);var h=null;this.width!=d||this.height!=a?(h=new p.Texture(d,a,{format:b.RGBA,filter:b.NEAREST}),this.copyTo(h),h=h.getPixels(b.UNSIGNED_BYTE,!0)):h=this.getPixels(b.UNSIGNED_BYTE,!0);var b=e.getContext("2d"),l=b.getImageData(0,0,d,a);l.data.set(h);b.putImageData(l,0,0);c&&(h=createCanvas(d,a),c=h.getContext("2d"),c.translate(0,h.height),c.scale(1,-1),c.drawImage(e,0,0,h.width,h.height),b.drawImage(h,0,0));return e};Texture.prototype.toBlob=function(){var e=this.width,c=this.height;if(this.texture_type==
gl.TEXTURE_CUBE_MAP){if(this.image)return e=createCanvas(this.image.width,this.image.height),c=e.getContext("2d"),c.drawImage(this.image,0,0),e.toBlob();console.warning("Litegl: cannot call toBlob of a cubemap GL.Texture");return null}var a=this.getPixels(),b=createCanvas(e,c);if(!b.toBlob)throw"toBlob not supported on Canvas element";var d=b.getContext("2d"),h=d.getImageData(0,0,e,c);h.data.set(a);d.putImageData(h,0,0);e=createCanvas(e,c);c=e.getContext("2d");c.translate(0,e.height);c.scale(1,-1);
c.drawImage(b,0,0);return e.toBlob()};Texture.prototype.toBase64=function(e){var c=this.width,a=this.height,b=this.getPixels(),d=createCanvas(c,a),h=d.getContext("2d"),l=h.getImageData(0,0,c,a);l.data.set(b);h.putImageData(l,0,0);e&&(e=createCanvas(c,a),c=e.getContext("2d"),c.translate(0,a),c.scale(1,-1),c.drawImage(d,0,0),d=e);return d.toDataURL("image/png")};Texture.prototype.generateMetadata=function(){var e={};e.width=this.width;e.height=this.height;this.metadata=e};Texture.compareFormats=function(e,
c){return e&&c?e==c?!0:e.width!=c.width||e.height!=c.height||e.type!=c.type||e.texture_type!=c.texture_type?!1:!0:!1};Texture.getWhiteTexture=function(){var e=this.gl,c=e.textures[":white"];if(c)return c;c=new Uint8Array([255,255,255,255]);return e.textures[":white"]=new p.Texture(1,1,{pixel_data:c})};Texture.getBlackTexture=function(){var e=this.gl,c=e.textures[":black"];if(c)return c;c=new Uint8Array([0,0,0,255]);return e.textures[":black"]=new p.Texture(1,1,{pixel_data:c})};p.FBO=G;G.prototype.setTextures=
function(e,c,a){var b=this.depth_texture==c;if(b&&e)if(e.length==this.color_textures.length)for(var d=0;d<e.length;++d){if(e[d]!=this.color_textures[d]){b=!1;break}}else b=!1;if(!b){this._old_fbo=gl.getParameter(gl.FRAMEBUFFER_BINDING);this.handler||(this.handler=gl.createFramebuffer());var h=b=-1,l=null,k=0;this.color_textures&&(k=this.color_textures.length);this.color_textures=e||[];this.depth_texture=c;if(e)for(d=0;d<e.length;d++){var g=e[d];if(-1==b)b=g.width;else if(b!=g.width)throw"Cannot use Texture.drawTo if textures have different dimensions";
if(-1==h)h=g.height;else if(h!=g.height)throw"Cannot use Texture.drawTo if textures have different dimensions";if(null==l)l=g.type;else if(l!=g.type)throw"Cannot use Texture.drawTo if textures have different data type, all must have the same type";}else b=c.width,h=c.height;this.width=b;this.height=h;gl.bindFramebuffer(gl.FRAMEBUFFER,this.handler);if(c&&!gl.extensions.WEBGL_depth_texture)throw"Rendering to depth texture not supported by your browser";l=gl.extensions.WEBGL_draw_buffers;if(!l&&e&&1<
e.length)throw"Rendering to several textures not supported by your browser";c?gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,c.handler,0):(c=this._renderbuffer=this._renderbuffer||gl.createRenderbuffer(),c.width=b,c.height=h,gl.bindRenderbuffer(gl.RENDERBUFFER,c),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,b,h),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,c));if(e){this.order=[];for(d=0;d<e.length;d++)g=e[d],gl.framebufferTexture2D(gl.FRAMEBUFFER,
gl.COLOR_ATTACHMENT0+d,gl.TEXTURE_2D,g.handler,0),this.order.push(gl.COLOR_ATTACHMENT0+d);for(d=e.length;d<k;++d)gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+d,gl.TEXTURE_2D,null,0)}else c=this._renderbuffer=this._renderbuffer||gl.createRenderbuffer(),c.width=b,c.height=h,gl.bindRenderbuffer(gl.RENDERBUFFER,c),gl.renderbufferStorage(gl.RENDERBUFFER,gl.RGBA4,b,h),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,c);e&&1<e.length&&l.drawBuffersWEBGL(this.order);
e=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(e!==gl.FRAMEBUFFER_COMPLETE)throw"FBO not complete: "+e;gl.bindTexture(gl.TEXTURE_2D,null);gl.bindRenderbuffer(gl.RENDERBUFFER,null);a||gl.bindFramebuffer(gl.FRAMEBUFFER,this._old_fbo)}};G.prototype.bind=function(e){if(!this.color_textures.length&&!this.depth_texture)throw"FBO: no textures attached to FBO";this._old_viewport.set(gl.viewport_data);this._old_fbo=e?gl.getParameter(gl.FRAMEBUFFER_BINDING):null;this._old_fbo!=this.handler&&gl.bindFramebuffer(gl.FRAMEBUFFER,
this.handler);gl.viewport(0,0,this.width,this.height)};G.prototype.unbind=function(){gl.bindFramebuffer(gl.FRAMEBUFFER,this._old_fbo);this._old_fbo=null;gl.setViewport(this._old_viewport)};t.Shader=p.Shader=function c(a,b,d){this._context_id=t.gl.context_id;var h=this.gl=t.gl;d=c.expandMacros(d);this.program=h.createProgram();a=a.constructor===String?p.Shader.compileSource(h.VERTEX_SHADER,d+a):a;b=b.constructor===String?p.Shader.compileSource(h.FRAGMENT_SHADER,d+b):b;h.attachShader(this.program,a,
h);h.attachShader(this.program,b,h);h.linkProgram(this.program);if(!h.getProgramParameter(this.program,h.LINK_STATUS))throw"link error: "+h.getProgramInfoLog(this.program);this.attributes={};this.uniformInfo={};this.samplers={};this.extractShaderInfo()};Shader.expandMacros=function(c){var a="";if(c)for(var b in c)a+="#define "+b+" "+(c[b]?c[b]:"")+"\n";return a};Shader.compileSource=function(c,a,b){b=b||t.gl;var d=b.createShader(c);b.shaderSource(d,a);b.compileShader(d);if(!b.getShaderParameter(d,
b.COMPILE_STATUS))throw(c==b.VERTEX_SHADER?"Vertex":"Fragment")+" shader compile error: "+b.getShaderInfoLog(d);return d};Shader.prototype.extractShaderInfo=function(){for(var c=this.gl,a=c.getProgramParameter(this.program,c.ACTIVE_UNIFORMS),b=0;b<a;++b){var d=c.getActiveUniform(this.program,b);if(!d)break;var h=d.name,l=h.indexOf("[");-1!=l&&-1==h.indexOf("].")&&(h=h.substr(0,l));if(d.type==c.SAMPLER_2D||d.type==c.SAMPLER_CUBE)this.samplers[h]=d.type;var l=Shader.getUniformFunc(d),k=!1;if(d.type==
c.FLOAT_MAT2||d.type==c.FLOAT_MAT3||d.type==c.FLOAT_MAT4)k=!0;this.uniformInfo[h]={type:d.type,func:l,size:d.size,is_matrix:k,loc:c.getUniformLocation(this.program,h)}}b=0;for(a=c.getProgramParameter(this.program,c.ACTIVE_ATTRIBUTES);b<a;++b){d=c.getActiveAttrib(this.program,b);if(!d)break;l=Shader.getUniformFunc(d);this.uniformInfo[d.name]={type:d.type,func:l,size:d.size,loc:null};this.attributes[d.name]=c.getAttribLocation(this.program,d.name)}};Shader.prototype.hasUniform=function(c){return this.uniformInfo[c]};
Shader.prototype.hasAttribute=function(c){return this.attributes[c]};Shader.getUniformFunc=function(c){var a=null;switch(c.type){case gl.FLOAT:a=1==c.size?gl.uniform1f:gl.uniform1fv;break;case gl.FLOAT_MAT2:a=gl.uniformMatrix2fv;break;case gl.FLOAT_MAT3:a=gl.uniformMatrix3fv;break;case gl.FLOAT_MAT4:a=gl.uniformMatrix4fv;break;case gl.FLOAT_VEC2:a=gl.uniform2fv;break;case gl.FLOAT_VEC3:a=gl.uniform3fv;break;case gl.FLOAT_VEC4:a=gl.uniform4fv;break;case gl.UNSIGNED_INT:case gl.INT:a=1==c.size?gl.uniform1i:
gl.uniform1iv;break;case gl.INT_VEC2:a=gl.uniform2iv;break;case gl.INT_VEC3:a=gl.uniform3iv;break;case gl.INT_VEC4:a=gl.uniform4iv;break;case gl.SAMPLER_2D:case gl.SAMPLER_CUBE:a=gl.uniform1i;break;default:a=gl.uniform1f}return a};Shader.fromURL=function(c,a,b){function d(){var a=new p.Shader(l,k),b;for(b in a)h[b]=a[b];h.ready=!0}var h=new p.Shader("\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tattribute vec3 a_vertex;\n\r\n\t\t\tattribute mat4 u_mvp;\n\r\n\t\t\tvoid main() { \n\r\n\t\t\t\tgl_Position = u_mvp * vec4(a_vertex,1.0); \n\r\n\t\t\t}\n\r\n\t\t",
"\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\r\n\t\t\t}\n\r\n\t\t\t");h.ready=!1;var l=null,k=null;HttpRequest(c,null,function(a){l=a;k&&d()});HttpRequest(a,null,function(a){k=a;l&&d()});return h};Shader.prototype.bind=function(){var c=this.gl;c.useProgram(this.program);c._current_shader=this};Shader.prototype.getLocation=function(c){return this.uniformInfo[c]?this.uniformInfo[c].loc:null};Shader._temp_uniform=new Float32Array(16);
Shader.prototype.uniforms=function(c){var a=this.gl;a.useProgram(this.program);a._current_shader=this;for(var b in c)this.setUniform(b,c[b]);return this};Shader.prototype.uniformsArray=function(c){var a=this.gl;a.useProgram(this.program);a._current_shader=this;for(var a=0,b=c.length;a<b;++a){var d=c[a],h;for(h in d)this._setUniform(h,d[h])}return this};Shader.prototype.setUniform=function(c,a){this.gl._current_shader!=this&&this.bind();var b=this.uniformInfo[c];b&&null!==b.loc&&null!=a&&(a.constructor===
Array&&(a=new Float32Array(a)),b.is_matrix?b.func.call(this.gl,b.loc,!1,a):b.func.call(this.gl,b.loc,a))};Shader.prototype._setUniform=function(c,a){var b=this.uniformInfo[c];b&&null!==b.loc&&null!=a&&(a.constructor===Array&&(a=new Float32Array(a)),b.is_matrix?b.func.call(this.gl,b.loc,!1,a):b.func.call(this.gl,b.loc,a))};Shader.prototype.draw=function(c,a,b){b=void 0===b?a==gl.LINES?"lines":"triangles":b;this.drawBuffers(c.vertexBuffers,b?c.indexBuffers[b]:null,2>arguments.length?gl.TRIANGLES:a)};
Shader.prototype.drawRange=function(c,a,b,d,h){h=void 0===h?a==gl.LINES?"lines":"triangles":h;this.drawBuffers(c.vertexBuffers,h?c.indexBuffers[h]:null,a,b,d)};var F=new Uint8Array(16),y=new Uint8Array(16);Shader.prototype.drawBuffers=function(c,a,b,d,h){if(0!=h){var l=this.gl;l.useProgram(this.program);var k=0;F.set(y);for(var g in c){var m=c[g],q=m.attribute||g,r=this.attributes[q];null!=r&&m.buffer&&(F[r]=1,l.bindBuffer(l.ARRAY_BUFFER,m.buffer),l.enableVertexAttribArray(r),l.vertexAttribPointer(r,
m.buffer.spacing,m.buffer.gl_type,!1,0,0),k=m.buffer.length/m.buffer.spacing)}c=0;0<d&&(c=d*(a&&a.data?a.data.constructor.BYTES_PER_ELEMENT:1));0<h?k=h:a&&(k=a.buffer.length-c);for(q in this.attributes)r=this.attributes[q],F[r]||l.disableVertexAttribArray(this.attributes[q]);!k||a&&!a.buffer||(a?(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a.buffer),l.drawElements(b,k,a.buffer.gl_type,c),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)):l.drawArrays(b,c,k));return this}};Shader.expandImports=function(c,a){a=a||
Shader.files;var b={};if(!a)throw"Shader.files not initialized, assign files there";return c.replace(/#import\s+\"([a-zA-Z0-9_\.]+)\"\s*\n/g,function(c){c=c.split('"')[1];if(b[c])return"//already imported: "+c+"\n";var h=a[c];b[c]=!0;return h?h+"\n":"//import code not found: "+c+"\n"})};Shader.SCREEN_VERTEX_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tattribute vec3 a_vertex;\n\r\n\t\t\tattribute vec2 a_coord;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tvoid main() { \n\r\n\t\t\t\tv_coord = a_coord; \n\r\n\t\t\t\tgl_Position = vec4(a_coord * 2.0 - 1.0, 0.0, 1.0); \n\r\n\t\t\t}\n\r\n\t\t\t";
Shader.SCREEN_FRAGMENT_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tgl_FragColor = texture2D(u_texture, v_coord);\n\r\n\t\t\t}\n\r\n\t\t\t";Shader.SCREEN_FRAGMENT_FX="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\t#ifdef FX_UNIFORMS\n\r\n\t\t\t\tFX_UNIFORMS\n\r\n\t\t\t#endif\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tvec2 uv = v_coord;\n\r\n\t\t\t\tvec4 color = texture2D(u_texture, uv);\n\r\n\t\t\t\t#ifdef FX_CODE\n\r\n\t\t\t\t\tFX_CODE ;\n\r\n\t\t\t\t#endif\n\r\n\t\t\t\tgl_FragColor = color;\n\r\n\t\t\t}\n\r\n\t\t\t";
Shader.SCREEN_COLORED_FRAGMENT_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\tuniform vec4 u_color;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tgl_FragColor = u_color * texture2D(u_texture, v_coord);\n\r\n\t\t\t}\n\r\n\t\t\t";Shader.SCREEN_FLAT_FRAGMENT_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform vec4 u_color;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tgl_FragColor = u_color;\n\r\n\t\t\t}\n\r\n\t\t\t";Shader.QUAD_VERTEX_SHADER=
"\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tattribute vec3 a_vertex;\n\r\n\t\t\tattribute vec2 a_coord;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tuniform vec2 u_position;\n\r\n\t\t\tuniform vec2 u_size;\n\r\n\t\t\tuniform vec2 u_viewport;\n\r\n\t\t\tuniform mat3 u_transform;\n\r\n\t\t\tvoid main() { \n\r\n\t\t\t\tvec3 pos = vec3(u_position + vec2(a_coord.x,1.0 - a_coord.y)  * u_size, 1.0);\n\r\n\t\t\t\tv_coord = a_coord; \n\r\n\t\t\t\tpos = u_transform * pos;\n\r\n\t\t\t\tpos.z = 0.0;\n\r\n\t\t\t\t//normalize\n\r\n\t\t\t\tpos.x = (2.0 * pos.x / u_viewport.x) - 1.0;\n\r\n\t\t\t\tpos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);\n\r\n\t\t\t\tgl_Position = vec4(pos, 1.0); \n\r\n\t\t\t}\n\r\n\t\t\t";
Shader.QUAD_FRAGMENT_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\tuniform vec4 u_color;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tgl_FragColor = u_color * texture2D(u_texture, v_coord);\n\r\n\t\t\t}\n\r\n\t\t\t";Shader.QUAD2_FRAGMENT_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\tuniform vec4 u_color;\n\r\n\t\t\tuniform vec4 u_texture_area;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t    vec2 uv = vec2( mix(u_texture_area.x, u_texture_area.z, v_coord.x), 1.0 - mix(u_texture_area.w, u_texture_area.y, v_coord.y) );\n\r\n\t\t\t\tgl_FragColor = u_color * texture2D(u_texture, uv);\n\r\n\t\t\t}\n\r\n\t\t\t";
Shader.PRIMITIVE2D_VERTEX_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tattribute vec3 a_vertex;\n\r\n\t\t\tuniform vec2 u_viewport;\n\r\n\t\t\tuniform mat3 u_transform;\n\r\n\t\t\tvoid main() { \n\r\n\t\t\t\tvec3 pos = a_vertex;\n\r\n\t\t\t\tpos = u_transform * pos;\n\r\n\t\t\t\tpos.z = 0.0;\n\r\n\t\t\t\t//normalize\n\r\n\t\t\t\tpos.x = (2.0 * pos.x / u_viewport.x) - 1.0;\n\r\n\t\t\t\tpos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);\n\r\n\t\t\t\tgl_Position = vec4(pos, 1.0); \n\r\n\t\t\t}\n\r\n\t\t\t";
Shader.FLAT_VERTEX_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tattribute vec3 a_vertex;\n\r\n\t\t\tuniform mat4 u_mvp;\n\r\n\t\t\tvoid main() { \n\r\n\t\t\t\tgl_Position = u_mvp * vec4(a_vertex,1.0); \n\r\n\t\t\t}\n\r\n\t\t\t";Shader.FLAT_FRAGMENT_SHADER="\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tuniform vec4 u_color;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t\tgl_FragColor = u_color;\n\r\n\t\t\t}\n\r\n\t\t\t";Shader.createFX=function(c,a){return new p.Shader(p.Shader.SCREEN_VERTEX_SHADER,
p.Shader.SCREEN_FRAGMENT_FX,{FX_CODE:c,FX_UNIFORMS:a||""})};Shader.prototype.toViewport=function(c){var a=p.Mesh.getScreenQuad();c&&this.uniforms(c);this.draw(a)};Shader.getScreenShader=function(c){c=c||t.gl;var a=c.shaders[":screen"];if(a)return a;a=c.shaders[":screen"]=new p.Shader(Shader.SCREEN_VERTEX_SHADER,Shader.SCREEN_FRAGMENT_SHADER);return a.uniforms({u_texture:0})};Shader.getColoredScreenShader=function(c){c=c||t.gl;var a=c.shaders[":colored_screen"];if(a)return a;a=c.shaders[":colored_screen"]=
new p.Shader(Shader.SCREEN_VERTEX_SHADER,Shader.SCREEN_COLORED_FRAGMENT_SHADER);return a.uniforms({u_texture:0,u_color:vec4.fromValues(1,1,1,1)})};Shader.getQuadShader=function(c){c=c||t.gl;var a=c.shaders[":quad"];return a?a:c.shaders[":quad"]=new p.Shader(Shader.QUAD_VERTEX_SHADER,Shader.QUAD_FRAGMENT_SHADER)};Shader.getPartialQuadShader=function(c){c=c||t.gl;var a=c.shaders[":quad2"];return a?a:c.shaders[":quad2"]=new p.Shader(Shader.QUAD_VERTEX_SHADER,Shader.QUAD2_FRAGMENT_SHADER)};Shader.getBlurShader=
function(c){c=c||t.gl;var a=c.shaders[":blur"];if(a)return a;a=new p.Shader(Shader.SCREEN_VERTEX_SHADER,"\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\tuniform vec2 u_offset;\n\r\n\t\t\tuniform float u_intensity;\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t   vec4 sum = vec4(0.0);\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * -4.0) * 0.05/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * -3.0) * 0.09/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * -2.0) * 0.12/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * -1.0) * 0.15/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord) * 0.16/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * 4.0) * 0.05/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * 3.0) * 0.09/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * 2.0) * 0.12/0.98;\n\r\n\t\t\t   sum += texture2D(u_texture, v_coord + u_offset * 1.0) * 0.15/0.98;\n\r\n\t\t\t   gl_FragColor = u_intensity * sum;\n\r\n\t\t\t}\n\r\n\t\t\t");
return c.shaders[":blur"]=a};Shader.FXAA_FUNC="\n\r\n\tuniform vec2 u_viewportSize;\n\r\n\tuniform vec2 u_iViewportSize;\n\r\n\t#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n\r\n\t#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n\r\n\t#define FXAA_SPAN_MAX     8.0\n\r\n\t\n\r\n\t/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */\n\r\n\tvec4 applyFXAA(sampler2D tex, vec2 fragCoord)\n\r\n\t{\n\r\n\t\tvec4 color = vec4(0.0);\n\r\n\t\t/*vec2 u_iViewportSize = vec2(1.0 / u_viewportSize.x, 1.0 / u_viewportSize.y);*/\n\r\n\t\tvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * u_iViewportSize).xyz;\n\r\n\t\tvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * u_iViewportSize).xyz;\n\r\n\t\tvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * u_iViewportSize).xyz;\n\r\n\t\tvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * u_iViewportSize).xyz;\n\r\n\t\tvec3 rgbM  = texture2D(tex, fragCoord  * u_iViewportSize).xyz;\n\r\n\t\tvec3 luma = vec3(0.299, 0.587, 0.114);\n\r\n\t\tfloat lumaNW = dot(rgbNW, luma);\n\r\n\t\tfloat lumaNE = dot(rgbNE, luma);\n\r\n\t\tfloat lumaSW = dot(rgbSW, luma);\n\r\n\t\tfloat lumaSE = dot(rgbSE, luma);\n\r\n\t\tfloat lumaM  = dot(rgbM,  luma);\n\r\n\t\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\r\n\t\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\r\n\t\t\n\r\n\t\tvec2 dir;\n\r\n\t\tdir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n\r\n\t\tdir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\r\n\t\t\n\r\n\t\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\r\n\t\t\n\r\n\t\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\r\n\t\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_iViewportSize;\n\r\n\t\t\n\r\n\t\tvec3 rgbA = 0.5 * (texture2D(tex, fragCoord * u_iViewportSize + dir * (1.0 / 3.0 - 0.5)).xyz + \n\r\n\t\t\ttexture2D(tex, fragCoord * u_iViewportSize + dir * (2.0 / 3.0 - 0.5)).xyz);\n\r\n\t\tvec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * u_iViewportSize + dir * -0.5).xyz + \n\r\n\t\t\ttexture2D(tex, fragCoord * u_iViewportSize + dir * 0.5).xyz);\n\r\n\t\t\n\r\n\t\treturn vec4(rgbA,1.0);\n\r\n\t\tfloat lumaB = dot(rgbB, luma);\n\r\n\t\tif ((lumaB < lumaMin) || (lumaB > lumaMax))\n\r\n\t\t\tcolor = vec4(rgbA, 1.0);\n\r\n\t\telse\n\r\n\t\t\tcolor = vec4(rgbB, 1.0);\n\r\n\t\treturn color;\n\r\n\t}\n\r\n";
Shader.getFXAAShader=function(c){c=c||t.gl;var a=c.shaders[":fxaa"];if(a)return a;a=new p.Shader(Shader.SCREEN_VERTEX_SHADER,"\n\r\n\t\t\tprecision highp float;\n\r\n\t\t\tvarying vec2 v_coord;\n\r\n\t\t\tuniform sampler2D u_texture;\n\r\n\t\t\t"+Shader.FXAA_FUNC+"\n\r\n\t\t\t\n\r\n\t\t\tvoid main() {\n\r\n\t\t\t   gl_FragColor = applyFXAA( u_texture, v_coord * u_viewportSize) ;\n\r\n\t\t\t}\n\r\n\t\t\t");return c.shaders[":fxaa"]=a};Shader.getFlatShader=function(c){c=c||t.gl;var a=c.shaders[":flat"];
if(a)return a;a=new p.Shader(Shader.FLAT_VERTEX_SHADER,Shader.FLAT_FRAGMENT_SHADER);a.uniforms({u_color:[1,1,1,1]});return c.shaders[":flat"]=a};p.create=function(c){function a(b){var c=g.mouse_buttons;p.augmentEvent(b,k);b.eventType=b.eventType||b.type;var d=getTime();q.dragging=b.dragging;q.x=b.canvasx;q.y=b.canvasy;q.left_button=g.mouse_buttons&1<<p.LEFT_MOUSE_BUTTON;q.right_button=g.mouse_buttons&1<<p.RIGHT_MOUSE_BUTTON;if("mousedown"==b.eventType){b.leftButton&&(q.left_button=!0);b.rightButton&&
(q.right_button=!0);0==c&&(k.removeEventListener("mousemove",a),c=k.ownerDocument,c.addEventListener("mousemove",a),c.addEventListener("mouseup",a));m=d;if(g.onmousedown)g.onmousedown(b);w.trigger(g,"mousedown")}else if("mousemove"==b.eventType){if(g.onmousemove)g.onmousemove(b);w.trigger(g,"mousemove",b)}else if("mouseup"==b.eventType){0==g.mouse_buttons&&(k.addEventListener("mousemove",a),c=k.ownerDocument,c.removeEventListener("mousemove",a),c.removeEventListener("mouseup",a));b.click_time=d-m;
m=d;if(g.onmouseup)g.onmouseup(b);w.trigger(g,"mouseup",b)}else if("mousewheel"==b.eventType||"wheel"==b.eventType||"DOMMouseScroll"==b.eventType){b.eventType="mousewheel";b.wheel="wheel"==b.type?-b.deltaY:null!=b.wheelDeltaY?b.wheelDeltaY:-60*b.detail;if(g.onmousewheel)g.onmousewheel(b);w.trigger(g,"mousewheel",b)}if(g.onmouse)g.onmouse(b);"mousemove"!=b.eventType&&b.stopPropagation();b.preventDefault();return!1}function b(a){var b=event.changedTouches,c=b[0],d="";if(!(a.touches.length&&a.changedTouches[0].identifier!==
a.touches[0].identifier||1<b)){switch(event.type){case "touchstart":d="mousedown";break;case "touchmove":d="mousemove";break;case "touchend":d="mouseup";break;default:return}a=document.createEvent("MouseEvent");a.initMouseEvent(d,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);c.target.dispatchEvent(a);event.preventDefault()}}function d(a){g.ongesture&&(a.eventType=a.type,g.ongesture(a));event.preventDefault()}function h(a,b){console.log(a);if(b&&g.onbuttondown)g.onbuttondown(a);
else if(!b&&g.onbuttonup)g.onbuttonup(a);if(g.onbutton)g.onbutton(a);w.trigger(g,b?"buttondown":"buttonup",a)}function l(a){console.log(a);if(g.ongamepad)g.ongamepad(a)}c=c||{};var k=null;if(c.canvas)if("string"==typeof c.canvas){if(k=document.getElementById(c.canvas),!k)throw"Canvas element not found: "+c.canvas;}else k=c.canvas;else k=createCanvas(c.width||800,c.height||600);"alpha"in c||(c.alpha=!1);try{t.gl=k.getContext("webgl",c)}catch(u){}try{t.gl=t.gl||k.getContext("experimental-webgl",c)}catch(u){}if(!t.gl)throw"WebGL not supported";
var g=t.gl;k.is_webgl=!0;g.context_id=this.last_context_id++;g.extensions={};g.extensions.OES_standard_derivatives=g.derivatives_supported=g.getExtension("OES_standard_derivatives")||!1;g.extensions.WEBGL_depth_texture=g.getExtension("WEBGL_depth_texture")||g.getExtension("WEBKIT_WEBGL_depth_texture")||g.getExtension("MOZ_WEBGL_depth_texture");g.extensions.OES_element_index_uint=g.getExtension("OES_element_index_uint");g.extensions.WEBGL_draw_buffers=g.getExtension("WEBGL_draw_buffers");g.extensions.EXT_shader_texture_lod=
g.getExtension("EXT_shader_texture_lod");g.extensions.EXT_sRGB=g.getExtension("EXT_sRGB");g.extensions.EXT_texture_filter_anisotropic=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic");g.extensions.EXT_frag_depth=g.getExtension("EXT_frag_depth")||g.getExtension("WEBKIT_EXT_frag_depth")||g.getExtension("MOZ_EXT_frag_depth");g.extensions.WEBGL_lose_context=g.getExtension("WEBGL_lose_context")||
g.getExtension("WEBKIT_WEBGL_lose_context")||g.getExtension("MOZ_WEBGL_lose_context");g.extensions.OES_texture_float_linear=g.getExtension("OES_texture_float_linear");g.extensions.OES_texture_float_linear&&(g.extensions.OES_texture_float=g.getExtension("OES_texture_float"));g.extensions.OES_texture_half_float_linear=g.getExtension("OES_texture_half_float_linear");g.extensions.OES_texture_half_float_linear&&(g.extensions.OES_texture_half_float=g.getExtension("OES_texture_half_float"));g.HALF_FLOAT_OES=
36193;g.extensions.OES_texture_half_float&&(g.HALF_FLOAT_OES=g.extensions.OES_texture_half_float.HALF_FLOAT_OES);g.HIGH_PRECISION_FORMAT=g.extensions.OES_texture_half_float?g.HALF_FLOAT_OES:g.extensions.OES_texture_float?g.FLOAT:g.UNSIGNED_BYTE;g.max_texture_units=g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS);g._viewport_func=g.viewport;g.viewport_data=new Float32Array([0,0,g.canvas.width,g.canvas.height]);g.viewport=function(a,b,c,d){var g=this.viewport_data;g[0]=a|0;g[1]=b|0;g[2]=c|0;g[3]=d|0;this._viewport_func(a,
b,c,d)};g.getViewport=function(a){return a?(a[0]=g.viewport_data[0],a[1]=g.viewport_data[1],a[2]=g.viewport_data[2],a[3]=g.viewport_data[3],a):new Float32Array(g.viewport_data)};g.setViewport=function(a){g.viewport_data.set(a);this._viewport_func(a[0],a[1],a[2],a[3])};if("undefined"==typeof glMatrix)throw"glMatrix not found, LiteGL requires glMatrix to be included";var m=0;g.mouse_buttons=0;g.shaders={};g.textures={};g.meshes={};g.makeCurrent=function(){t.gl=this};g.execute=function(a){var b=t.gl;
t.gl=this;a();t.gl=b};g.animate=function(a){function b(){if(!g.destroyed){h._requestFrame_id=c(b);var a=getTime(),k=.001*(a-d);if(h.onupdate)h.onupdate(k);w.trigger(g,"update",k);h.ondraw&&(k=t.gl,t.gl=h,h.ondraw(),w.trigger(g,"draw"),t.gl=k);d=a}}if(!1===a)t.cancelAnimationFrame(this._requestFrame_id),this._requestFrame_id=null;else{var c=t.requestAnimationFrame,d=getTime(),h=this;this._requestFrame_id=c(b)}};g.destroy=function(){r&&(document.removeEventListener("keydown",r),document.removeEventListener("keyup",
r));this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);this.destroyed=!0;t.gl==this&&(t.gl=null)};var q=g.mouse={left_button:!1,middle_button:!1,right_button:!1,x:0,y:0,deltax:0,deltay:0};g.captureMouse=function(c){k.addEventListener("mousedown",a);k.addEventListener("mousemove",a);c&&(k.addEventListener("mousewheel",a,!1),k.addEventListener("wheel",a,!1));k.addEventListener("contextmenu",function(a){a.preventDefault();return!1});k.addEventListener("touchstart",b,!0);k.addEventListener("touchmove",
b,!0);k.addEventListener("touchend",b,!0);k.addEventListener("touchcancel",b,!0);k.addEventListener("gesturestart",d);k.addEventListener("gesturechange",d);k.addEventListener("gestureend",d)};g.keys={};var r=null;g.captureKeys=function(a,b){function c(b){b.eventType=b.type;var d=b.target.nodeName.toLowerCase();if("input"!==d&&"textarea"!==d&&"select"!==d){b.character=String.fromCharCode(b.keyCode).toLowerCase();var d=!1,h=p.mapKeyCode(b.keyCode);h||(h=b.character);b.altKey||b.ctrlKey||b.metaKey||
(h&&(g.keys[h]="keydown"==b.type),d=g.keys[b.keyCode],g.keys[b.keyCode]="keydown"==b.type);if(d!=g.keys[b.keyCode]){if("keydown"==b.type&&g.onkeydown)g.onkeydown(b);else if("keyup"==b.type&&g.onkeyup)g.onkeyup(b);w.trigger(g,b.type,b)}if(g.onkey)g.onkey(b);a&&(b.isChar||p.blockable_keys[b.keyIdentifier||b.key])&&b.preventDefault()}}r||(g.keys={},document.addEventListener("keydown",c),document.addEventListener("keyup",c),r=c)};g.gamepads=null;g.captureGamepads=function(){var a=navigator.getGamepads||
navigator.webkitGetGamepads||navigator.mozGetGamepads;a&&(this.gamepads=a.call(navigator),window.addEventListener("gamepadButtonDown",function(a){h(a,!0)},!1),window.addEventListener("MozGamepadButtonDown",function(a){h(a,!0)},!1),window.addEventListener("WebkitGamepadButtonDown",function(a){h(a,!0)},!1),window.addEventListener("gamepadButtonUp",function(a){h(a,!1)},!1),window.addEventListener("MozGamepadButtonUp",function(a){h(a,!1)},!1),window.addEventListener("WebkitGamepadButtonUp",function(a){h(a,
!1)},!1),window.addEventListener("gamepadconnected",l,!1),window.addEventListener("gamepaddisconnected",l,!1))};g.getGamepads=function(){var a=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(a){for(var a=a.call(navigator),b=null,c=0;4>c;c++)if(a[c]){b=a[c];if(this.gamepads)if(!this.gamepads[c]&&a[c]&&this.ongamepadconnected)this.ongamepadconnected(b);else if(this.gamepads[c]&&!a[c]&&this.ongamepaddisconnected)this.ongamepaddisconnected(this.gamepads[c]);var d={axes:[],
buttons:{},hat:""};d.axes.lx=b.axes[0];d.axes.ly=b.axes[1];d.axes.rx=b.axes[2];d.axes.ry=b.axes[3];d.axes.triggers=b.axes[4];for(c=0;c<b.buttons.length;c++)switch(c){case 0:d.buttons.a=b.buttons[c].pressed;break;case 1:d.buttons.b=b.buttons[c].pressed;break;case 2:d.buttons.x=b.buttons[c].pressed;break;case 3:d.buttons.y=b.buttons[c].pressed;break;case 4:d.buttons.lb=b.buttons[c].pressed;break;case 5:d.buttons.rb=b.buttons[c].pressed;break;case 6:d.buttons.lt=b.buttons[c].pressed;break;case 7:d.buttons.rt=
b.buttons[c].pressed;break;case 8:d.buttons.back=b.buttons[c].pressed;break;case 9:d.buttons.start=b.buttons[c].pressed;break;case 10:d.buttons.ls=b.buttons[c].pressed;break;case 11:d.buttons.rs=b.buttons[c].pressed;break;case 12:b.buttons[c].pressed&&(d.hat+="up");break;case 13:b.buttons[c].pressed&&(d.hat+="down");break;case 14:b.buttons[c].pressed&&(d.hat+="left");break;case 15:b.buttons[c].pressed&&(d.hat+="right");break;case 16:d.buttons.home=b.buttons[c].pressed}b.xbox=d}return this.gamepads=
a}};g.fullscreen=function(){var a=this.canvas;a.requestFullScreen?a.requestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():console.error("Fullscreen not supported")};g.snapshot=function(a,b,c,d,h){var k=createCanvas(c,d),l=k.getContext("2d"),m=l.getImageData(0,0,k.width,k.height),n=new Uint8Array(c*d*4);g.readPixels(a,b,k.width,k.height,g.RGBA,g.UNSIGNED_BYTE,n);m.data.set(n);l.putImageData(m,0,0);if(h)return k;a=createCanvas(c,d);
l=a.getContext("2d");l.translate(0,d);l.scale(1,-1);l.drawImage(k,0,0);return a};var n={};g.loadTexture=function(a,b,c){if(this.textures[a])return this.textures[a];if(n[a])return null;var d=new Image;d.url=a;d.onload=function(){var a=p.Texture.fromImage(this,b);a.img=this;g.textures[this.url]=a;delete n[this.url];c&&c(a)};d.src=a;n[a]=!0;return null};g.drawTexture=function(){var a=mat3.create(),b=vec2.create(),c=vec2.create(),d=vec4.create(),h=vec4.fromValues(1,1,1,1),k=vec2.create(),l={u_texture:0,
u_position:b,u_color:h,u_size:c,u_texture_area:d,u_viewport:k,u_transform:a};return function(a,h,m,n,r,q,p,u,t,w,v){b[0]=h;b[1]=m;void 0===n&&(n=a.width);void 0===r&&(r=a.height);c[0]=n;c[1]=r;void 0===q&&(q=0);void 0===p&&(p=0);void 0===u&&(u=a.width);void 0===t&&(t=a.height);d[0]=q/a.width;d[1]=p/a.height;d[2]=(q+u)/a.width;d[3]=(p+t)/a.height;k[0]=this.viewport_data[2];k[1]=this.viewport_data[3];w=w||Shader.getPartialQuadShader(this);h=Mesh.getScreenQuad(this);a.bind(0);w.uniforms(l);v&&w.uniforms(v);
w.draw(h,g.TRIANGLES)}}();g.canvas.addEventListener("webglcontextlost",function(a){a.preventDefault();if(g.onlosecontext)g.onlosecontext(a)},!1);g.reset=function(){g.viewport(0,0,this.canvas.width,this.canvas.height);g.disable(g.BLEND);g.disable(g.CULL_FACE);g.disable(g.DEPTH_TEST);g.frontFace(g.CCW);g._current_texture_drawto=null;g._current_fbo_color=null;g._current_fbo_depth=null};g.reset();return g};p.mapKeyCode=function(c){return{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",27:"ESCAPE",
32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[c]||(65<=c&&90>=c?String.fromCharCode(c):null)};p.dragging=!1;p.last_pos=[0,0];p.augmentEvent=function(c,a){var b=null;a=a||c.target||gl.canvas;b=a.getBoundingClientRect();c.mousex=c.pageX-b.left;c.mousey=c.pageY-b.top;c.canvasx=c.mousex;c.canvasy=b.height-c.mousey;c.deltax=0;c.deltay=0;"mousedown"==c.type?(this.dragging=!0,gl.mouse_buttons|=1<<c.which):"mousemove"!=c.type&&"mouseup"==c.type&&(gl.mouse_buttons&=~(1<<c.which),0==gl.mouse_buttons&&
(this.dragging=!1));c.deltax=c.mousex-this.last_pos[0];c.deltay=c.mousey-this.last_pos[1];this.last_pos[0]=c.mousex;this.last_pos[1]=c.mousey;c.dragging=this.dragging;c.buttons_mask=gl.mouse_buttons;c.leftButton=gl.mouse_buttons&1<<p.LEFT_MOUSE_BUTTON;c.rightButton=gl.mouse_buttons&1<<p.RIGHT_MOUSE_BUTTON;c.isButtonPressed=function(a){return this.buttons_mask&1<<a}};var w=t.LEvent=p.LEvent={jQuery:!1,bind:function(c,a,b,d){if(!c)throw"cannot bind event to null";if(!b)throw"cannot bind to null callback";
if(c.constructor===String)throw"cannot bind event to a string";a="__on_"+a;c.hasOwnProperty(a)?c[a].push([b,d]):c[a]=[[b,d]]},unbind:function(c,a,b,d){if(!c)throw"cannot unbind event to null";if(!b)throw"cannot unbind from null callback";if(c.constructor===String)throw"cannot bind event to a string";a="__on_"+a;if(c.hasOwnProperty(a)){for(var h=0,l=c[a].length;h<l;++h){var k=c[a][h];if(k[0]===b&&k[1]===d){c[a].splice(h,1);break}}0==c[a].length&&delete c[a]}},unbindAll:function(c,a){if(!c)throw"cannot unbind events in null";
if(!a){var b=[],d;for(d in c)"__on_"==d.substring(0,5)&&b.push(d);for(d in b)delete c[remove[d]]}else for(d in c)if("__on_"==d.substring(0,5)){for(var b=c[d],h=0;h<b.length;++h)b[h][1]==a&&(b.splice(h,1),--h);0==b.length&&delete c[d]}},isBind:function(c,a,b,d){a="__on_"+a;if(!c||!c.hasOwnProperty(a))return!1;for(var h=0,l=c[a].length;h<l;++h){var k=c[a][h];if(k[0]===b&&k[1]===d)return!0}return!1},trigger:function(c,a,b,d){if(!c)throw"cannot trigger event from null";if(c.constructor===String)throw"cannot bind event to a string";
w.jQuery&&!d&&$(c).trigger(":"+a,b);d="__on_"+a;if(c.hasOwnProperty(d)){c=c[d];d=0;for(var h=c.length;d<h;++d){var l=c[d];if(0==l[0].call(l[1],a,b))break}}},triggerArray:function(c,a,b,d){d=w.jQuery&&!d;for(var h="__on_"+a,l=0,k=c.length;l<k;++l){var g=c[l];if(!g)throw"cannot trigger event from null";if(g.constructor===String)throw"cannot bind event to a string";d&&$(g).trigger(":"+a,b);if(g.hasOwnProperty(h))for(var m=0,q=g[h].length;m<q;++m){var r=g[h][m];if(0==r[0].call(r[1],a,b))break}}}};t.CLIP_INSIDE=
p.CLIP_INSIDE=0;t.CLIP_OUTSIDE=p.CLIP_OUTSIDE=1;t.CLIP_OVERLAP=p.CLIP_OVERLAP=2;t.geo={createPlane:function(c,a){return new Float32Array([a[0],a[1],a[2],-vec3.dot(c,a)])},distancePointToPlane:function(c,a){return(vec3.dot(c,a)+a[3])/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},distance2PointToPlane:function(c,a){return(vec3.dot(c,a)+a[3])/(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},projectPointOnPlane:function(c,a,b,d){d=d||vec3.create();a=vec3.subtract(vec3.create(),c,a);a=vec3.dot(a,b);return vec3.subtract(d,
c,vec3.scale(vec3.create(),b,a))},reflectPointInPlane:function(c,a,b){a=-(-1*(a[0]*b[0]+a[1]*b[1]+a[2]*b[2])+b[0]*c[0]+b[1]*c[1]+b[2]*c[2])/(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);return vec3.fromValues(c[0]+a*b[0]*2,c[1]+a*b[1]*2,c[2]+a*b[2]*2)},testRayPlane:function(c,a,b,d,h){b=vec3.dot(b,d)-vec3.dot(d,c);d=vec3.dot(d,a);if(Math.abs(d)<EPSILON)return!1;d=b/d;if(0>d)return!1;h&&vec3.add(h,c,vec3.scale(h,a,d));return!0},testSegmentPlane:function(){var c=vec3.create();return function(a,b,d,h,l){d=vec3.dot(d,
h)-vec3.dot(h,a);b=vec3.sub(c,b,a);h=vec3.dot(h,b);if(Math.abs(h)<EPSILON)return!1;h=d/h;if(0>h||1<h)return!1;l&&vec3.add(l,a,vec3.scale(l,b,h));return!0}}(),testRaySphere:function(){var c=vec3.create();return function(a,b,d,h,l,k){var g=vec3.subtract(c,a,d),m=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];d=2*g[0]*b[0]+2*g[1]*b[1]+2*g[2]*b[2];h=d*d-4*m*(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]-h*h);if(0>h)return!1;if(l){h=Math.sqrt(h);g=1/(2*m);m=(-d+h)*g;d=(-d-h)*g;d=m<d?m:d;if(d>k)return!1;vec3.add(l,a,vec3.scale(l,b,d))}return!0}}(),
testRayCylinder:function(c,a,b,d,h,l){var k=vec3.clone(c);c=vec3.add(vec3.create(),c,vec3.scale(vec3.create(),a,1E5));var g=0;a=vec3.subtract(vec3.create(),d,b);var m=vec3.subtract(vec3.create(),k,b);b=vec3.subtract(vec3.create(),c,k);d=vec3.dot(m,a);c=vec3.dot(b,a);a=vec3.dot(a,a);if(0>d&&0>d+c||d>a&&d+c>a)return!1;var q=vec3.dot(b,b),r=vec3.dot(m,b),g=a*q-c*c;h=vec3.dot(m,m)-h*h;var n=a*h-d*d;if(Math.abs(g)<EPSILON){if(0<n)return!1;g=0>d?-r/q:d>a?(c-r)/q:0;l&&vec3.add(l,k,vec3.scale(vec3.create(),
b,g));return!0}m=a*r-c*d;n=m*m-g*n;if(0>n)return!1;g=(-m-Math.sqrt(n))/g;if(0>g||1<g)return!1;if(0>d+g*c){if(0>=c)return!1;g=-d/c;l&&vec3.add(l,k,vec3.scale(vec3.create(),b,g));return 0>=h+2*g*(r+g*q)}if(d+g*c>a){if(0<=c)return!1;g=(a-d)/c;l&&vec3.add(l,k,vec3.scale(vec3.create(),b,g));return 0>=h+a-2*d+g*(2*(r-c)+g*q)}l&&vec3.add(l,k,vec3.scale(vec3.create(),b,g));return!0},testRayBox:function(c,a,b,d,h,l){h=h||vec3.create();l=l||Number.MAX_VALUE;for(var k=!0,g=new Float32Array(3),m=0,q=new Float32Array(3),
r=new Float32Array(3),m=0;3>m;++m)c[m]<b[m]?(g[m]=1,r[m]=b[m],k=!1):c[m]>d[m]?(g[m]=0,r[m]=d[m],k=!1):g[m]=2;if(k)return vec3.copy(h,c),!0;for(m=0;3>m;++m)q[m]=2!=g[m]&&0!=a[m]?(r[m]-c[m])/a[m]:-1;k=0;for(m=1;3>m;m++)q[k]<q[m]&&(k=m);if(0>q[k]||q[k]>l)return!1;for(m=0;3>m;++m)if(k!=m){if(h[m]=c[m]+q[k]*a[m],h[m]<b[m]||h[m]>d[m])return!1}else h[m]=r[m];return!0},testRayBBox:function(c,a,b,d,h,l){if(d){var k=mat4.invert(mat4.create(),d);a=vec3.add(vec3.create(),c,a);c=vec3.transformMat4(vec3.create(),
c,k);vec3.transformMat4(a,a,k);vec3.sub(a,a,c);a=vec3.normalize(a,a)}c=this.testRayBox(c,a,b.subarray(6,9),b.subarray(9,12),h,l);d&&vec3.transformMat4(h,h,d);return c},testPointBBox:function(c,a){return c[0]<a[6]||c[0]>a[9]||c[1]<a[7]||c[0]>a[10]||c[2]<a[8]||c[0]>a[11]?!1:!0},testBBoxBBox:function(c,a){if(Math.abs(a[0]-c[0])>c[3]+a[3]||Math.abs(a[1]-c[1])>c[4]+a[4]||Math.abs(a[2]-c[2])>c[5]+a[5])return!1;var b=BBox.getMin(a);geo.testPointBBox(b,c)&&(b=BBox.getMax(a),geo.testPointBBox(b,c));return!0},
testSphereBBox:function(c,a,b){for(var d=0,h=BBox.getMin(b),l=BBox.getMax(b),k=0;3>k;++k)c[k]<h[k]?(b=c[k]-h[k],d+=b*b):c[k]>l[k]&&(b=c[k]-l[k],d+=b*b);return d<=a*a?!0:!1},closestPointBetweenLines:function(c,a,b,d,h,l){a=vec3.subtract(vec3.create(),a,c);d=vec3.subtract(vec3.create(),d,b);var k=vec3.subtract(vec3.create(),c,b),g=vec3.dot(a,a),m=vec3.dot(a,d),q=vec3.dot(d,d),r=vec3.dot(a,k),n=vec3.dot(d,k),p=g*q-m*m,t;p<EPSILON?(t=0,g=m>q?r/m:n/q):(t=(m*n-q*r)/p,g=(g*n-m*r)/p);h&&vec3.add(h,c,vec3.scale(vec3.create(),
a,t));l&&vec3.add(l,b,vec3.scale(vec3.create(),d,g));c=vec3.add(vec3.create(),k,vec3.subtract(vec3.create(),vec3.scale(vec3.create(),a,t),vec3.scale(vec3.create(),d,g)));return vec3.length(c)},extractPlanes:function(c,a){function b(b){var c=a.subarray(b,b+3),c=vec3.length(c);0!==c&&(c=1/c,a[b]*=c,a[b+1]*=c,a[b+2]*=c,a[b+3]*=c)}a=a||new Float32Array(24);a.set([c[3]-c[0],c[7]-c[4],c[11]-c[8],c[15]-c[12]],0);b(0);a.set([c[3]+c[0],c[7]+c[4],c[11]+c[8],c[15]+c[12]],4);b(4);a.set([c[3]+c[1],c[7]+c[5],c[11]+
c[9],c[15]+c[13]],8);b(8);a.set([c[3]-c[1],c[7]-c[5],c[11]-c[9],c[15]-c[13]],12);b(12);a.set([c[3]-c[2],c[7]-c[6],c[11]-c[10],c[15]-c[14]],16);b(16);a.set([c[3]+c[2],c[7]+c[6],c[11]+c[10],c[15]+c[14]],20);b(20);return a},frustumTestBox:function(c,a){var b=0,d=0,b=planeBoxOverlap(c.subarray(0,4),a);if(b==CLIP_OUTSIDE)return CLIP_OUTSIDE;d+=b;b=planeBoxOverlap(c.subarray(4,8),a);if(b==CLIP_OUTSIDE)return CLIP_OUTSIDE;d+=b;b=planeBoxOverlap(c.subarray(8,12),a);if(b==CLIP_OUTSIDE)return CLIP_OUTSIDE;
d+=b;b=planeBoxOverlap(c.subarray(12,16),a);if(b==CLIP_OUTSIDE)return CLIP_OUTSIDE;d+=b;b=planeBoxOverlap(c.subarray(16,20),a);if(b==CLIP_OUTSIDE)return CLIP_OUTSIDE;d+=b;b=planeBoxOverlap(c.subarray(20,24),a);return b==CLIP_OUTSIDE?CLIP_OUTSIDE:0==d+b?CLIP_INSIDE:CLIP_OVERLAP},frustumTestSphere:function(c,a,b){var d,h=!1;d=distanceToPlane(c.subarray(0,4),a);if(d<-b)return CLIP_OUTSIDE;d>=-b&&d<=b&&(h=!0);d=distanceToPlane(c.subarray(4,8),a);if(d<-b)return CLIP_OUTSIDE;d>=-b&&d<=b&&(h=!0);d=distanceToPlane(c.subarray(8,
12),a);if(d<-b)return CLIP_OUTSIDE;d>=-b&&d<=b&&(h=!0);d=distanceToPlane(c.subarray(12,16),a);if(d<-b)return CLIP_OUTSIDE;d>=-b&&d<=b&&(h=!0);d=distanceToPlane(c.subarray(16,20),a);if(d<-b)return CLIP_OUTSIDE;d>=-b&&d<=b&&(h=!0);d=distanceToPlane(c.subarray(20,24),a);if(d<-b)return CLIP_OUTSIDE;d>=-b&&d<=b&&(h=!0);return h?CLIP_OVERLAP:CLIP_INSIDE},testPoint2DInPolygon:function(c,a){for(var b=!1,d=-1,h=c.length,l=h-1;++d<h;l=d)(c[d][1]<=a[1]&&a[1]<c[l][1]||c[l][1]<=a[1]&&a[1]<c[d][1])&&a[0]<(c[l][0]-
c[d][0])*(a[1]-c[d][1])/(c[l][1]-c[d][1])+c[d][0]&&(b=!b);return b}};t.BBox=p.BBox={center:0,halfsize:3,min:6,max:9,radius:12,data_length:13,corners:new Float32Array([1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1]),tmp_corners:new Float32Array(24),create:function(){return new Float32Array(13)},clone:function(c){return new Float32Array(c)},copy:function(c,a){c.set(a);return c},fromPoint:function(c){var a=this.create();a.set(c,0);a.set(c,6);a.set(c,9);return a},fromMinMax:function(c,a){var b=
this.create();this.setMinMax(b,c,a);return b},fromCenterHalfsize:function(c,a){var b=this.create();this.setCenterHalfsize(b,c,a);return b},fromPoints:function(c){var a=this.create();this.setFromPoints(a,c);return a},setFromPoints:function(c,a){var b=c.subarray(6,9),d=c.subarray(9,12);b.set(a.subarray(0,3));d.set(b);for(var h=0,l=3,k=a.length;l<k;l+=3)h=a.subarray(l,l+3),vec3.min(b,h,b),vec3.max(d,h,d);b=vec3.add(c.subarray(0,3),b,d);vec3.scale(b,b,.5);vec3.subtract(c.subarray(3,6),d,b);c[12]=vec3.length(c.subarray(3,
6));return c},setMinMax:function(c,a,b){c[6]=a[0];c[7]=a[1];c[8]=a[2];c[9]=b[0];c[10]=b[1];c[11]=b[2];var d=c.subarray(3,6);vec3.sub(d,b,a);vec3.scale(d,d,.5);c[0]=b[0]-d[0];c[1]=b[1]-d[1];c[2]=b[2]-d[2];c[12]=vec3.length(c.subarray(3,6));return c},setCenterHalfsize:function(c,a,b,d){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=b[0];c[4]=b[1];c[5]=b[2];vec3.sub(c.subarray(6,9),c.subarray(0,3),c.subarray(3,6));vec3.add(c.subarray(9,12),c.subarray(0,3),c.subarray(3,6));c[12]=d?d:vec3.length(b);return c},transformMat4:function(c,
a,b){var d=a.subarray(3,6),h=this.tmp_corners;h.set(this.corners);for(var l=0;8>l;++l){var k=h.subarray(3*l,3*l+3);vec3.multiply(k,d,k);vec3.add(k,k,a);mat4.multiplyVec3(k,b,k)}return this.setFromPoints(c,h)},getCorners:function(c,a){var b=c.subarray(3,6),d=null;a?(a.set(this.corners),d=a):d=new Float32Array(this.corners);for(var h=0;8>h;++h){var l=d.subarray(3*h,3*h+3);vec3.multiply(l,b,l);vec3.add(l,l,c)}return d},merge:function(c,a,b){c=c||BBox.create();var d=c.subarray(6,9),h=c.subarray(9,12);
vec3.min(d,a.subarray(6,9),b.subarray(6,9));vec3.max(h,a.subarray(9,12),b.subarray(9,12));return BBox.setMinMax(c,d,h)},getCenter:function(c){return c.subarray(0,3)},getHalfsize:function(c){return c.subarray(3,6)},getMin:function(c){return c.subarray(6,9)},getMax:function(c){return c.subarray(9,12)},getRadius:function(c){return c[12]}};t.distanceToPlane=p.distanceToPlane=function(c,a){return vec3.dot(c,a)+c[3]};t.planeBoxOverlap=p.planeBoxOverlap=function(c,a){var b=c[3],d=vec3.fromValues(Math.abs(a[3]*
c[0]),Math.abs(a[4]*c[1]),Math.abs(a[5]*c[2])),d=d[0]+d[1]+d[2],b=vec3.dot(c,a)+b;return b<=-d?CLIP_OUTSIDE:b<=d?CLIP_OVERLAP:CLIP_INSIDE};t.Octree=p.Octree=function(c){this.root=null;this.total_nodes=this.total_depth=0;c&&(this.buildFromMesh(c),this.total_nodes=this.trim())};Octree.MAX_NODE_TRIANGLES_RATIO=.1;Octree.MAX_OCTREE_DEPTH=8;Octree.OCTREE_MARGIN_RATIO=.01;Octree.OCTREE_MIN_MARGIN=.1;Octree.prototype.buildFromMesh=function(c){this.total_nodes=this.total_depth=0;var a=c.getBuffer("vertices").data;
if(c=c.getIndexBuffer("triangles"))c=c.data;var b=this.computeAABB(a);this.root=b;this.total_nodes=1;this.total_triangles=c?c.length/3:a.length/9;this.max_node_triangles=this.total_triangles*Octree.MAX_NODE_TRIANGLES_RATIO;var d=vec3.create();vec3.scale(d,b.size,Octree.OCTREE_MARGIN_RATIO);d[0]<Octree.OCTREE_MIN_MARGIN&&(d[0]=Octree.OCTREE_MIN_MARGIN);d[1]<Octree.OCTREE_MIN_MARGIN&&(d[1]=Octree.OCTREE_MIN_MARGIN);d[2]<Octree.OCTREE_MIN_MARGIN&&(d[2]=Octree.OCTREE_MIN_MARGIN);vec3.sub(b.min,b.min,
d);vec3.add(b.max,b.max,d);b.faces=[];b.inside=0;if(c)for(d=0;d<c.length;d+=3){var h=new Float32Array([a[3*c[d]],a[3*c[d]+1],a[3*c[d]+2],a[3*c[d+1]],a[3*c[d+1]+1],a[3*c[d+1]+2],a[3*c[d+2]],a[3*c[d+2]+1],a[3*c[d+2]+2]]);this.addToNode(h,b,0)}else for(d=0;d<a.length;d+=9)h=new Float32Array(a.subarray(d,d+9)),this.addToNode(h,b,0);return b};Octree.prototype.addToNode=function(c,a,b){a.inside+=1;if(a.c){var d=this.computeAABB(c),h=!1,l;for(l in a.c){var k=a.c[l];if(Octree.isInsideAABB(d,k)){this.addToNode(c,
k,b+1);h=!0;break}}h||(null==a.faces&&(a.faces=[]),a.faces.push(c))}else if(null==a.faces&&(a.faces=[]),a.faces.push(c),a.faces.length>this.max_node_triangles&&b<Octree.MAX_OCTREE_DEPTH){this.splitNode(a);this.total_depth<b+1&&(this.total_depth=b+1);var g=a.faces.concat();a.faces=null;for(l in g){c=g[l];var d=this.computeAABB(c),h=!1,m;for(m in a.c)if(k=a.c[m],Octree.isInsideAABB(d,k)){this.addToNode(c,k,b+1);h=!0;break}h||(null==a.faces&&(a.faces=[]),a.faces.push(c))}}};Octree.prototype.octree_pos_ref=
[[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]];Octree.prototype.splitNode=function(c){c.c=[];var a=[.5*(c.max[0]-c.min[0]),.5*(c.max[1]-c.min[1]),.5*(c.max[2]-c.min[2])],b;for(b in this.octree_pos_ref){var d=this.octree_pos_ref[b],h={};this.total_nodes+=1;h.min=[c.min[0]+a[0]*d[0],c.min[1]+a[1]*d[1],c.min[2]+a[2]*d[2]];h.max=[h.min[0]+a[0],h.min[1]+a[1],h.min[2]+a[2]];h.faces=null;h.inside=0;c.c.push(h)}};Octree.prototype.computeAABB=function(c){for(var a=new Float32Array([c[0],
c[1],c[2]]),b=new Float32Array([c[0],c[1],c[2]]),d=0;d<c.length;d+=3)for(var h=0;3>h;h++)a[h]>c[d+h]&&(a[h]=c[d+h]),b[h]<c[d+h]&&(b[h]=c[d+h]);return{min:a,max:b,size:vec3.sub(vec3.create(),b,a)}};Octree.prototype.trim=function(c){c=c||this.root;if(!c.c)return 1;for(var a=1,b=[],d=c.c,h=0;h<d.length;++h)d[h].inside&&(b.push(d[h]),a+=this.trim(d[h]));c.c=b;return a};Octree.prototype.testRay=function(c,a,b,d){c=vec3.clone(c);a=vec3.clone(a);if(!this.root)throw"Error: octree not build";b=Octree.hitTestBox(c,
a,vec3.clone(this.root.min),vec3.clone(this.root.max));if(!b)return null;b=Octree.testRayInNode(this.root,c,a);return null!=b?(a=vec3.scale(vec3.create(),a,b.t),vec3.add(a,a,c),b.pos=a,b):null};Octree.testRayInNode=function(c,a,b){var d=null,h=null;if(c.faces)for(var l=0,k=c.faces.length;l<k;++l)d=c.faces[l],d=Octree.hitTestTriangle(a,b,d.subarray(0,3),d.subarray(3,6),d.subarray(6,9)),null!=d&&(h?h.mergeWith(d):h=d);if(c.c)for(l=0;l<c.c.length;++l)k=c.c[l],d=Octree.hitTestBox(a,b,vec3.clone(k.min),
vec3.clone(k.max)),null==d||h&&d.t>h.t||(d=Octree.testRayInNode(k,a,b),null!=d&&(h?h.mergeWith(d):h=d));return h};Octree.isInsideAABB=function(c,a){return c.min[0]<a.min[0]||c.min[1]<a.min[1]||c.min[2]<a.min[2]||c.max[0]>a.max[0]||c.max[1]>a.max[1]||c.max[2]>a.max[2]?!1:!0};Octree.hitTestBox=function(){var c=vec3.create(),a=vec3.create(),b=vec3.create(),d=vec3.create(),h=vec3.create(),l=vec3.create(),k=vec3.fromValues(1E-6,1E-6,1E-6);return function(g,m,q,r){vec3.subtract(c,q,g);vec3.subtract(a,r,
g);if(0>vec3.maxValue(c)&&0<vec3.minValue(a))return new HitTest(0,g,m);b[0]=1/m[0];b[1]=1/m[1];b[2]=1/m[2];vec3.multiply(c,c,b);vec3.multiply(a,a,b);vec3.min(d,c,a);vec3.max(h,c,a);var n=vec3.maxValue(d),p=vec3.minValue(h);return 0<n&&n<p?(g=vec3.add(vec3.create(),vec3.scale(l,m,n),g),vec3.add(q,q,k),vec3.subtract(q,q,k),new HitTest(n,g,vec3.fromValues((g[0]>r[0])-(g[0]<q[0]),(g[1]>r[1])-(g[1]<q[1]),(g[2]>r[2])-(g[2]<q[2])))):null}}();Octree.hitTestTriangle=function(){var c=vec3.create(),a=vec3.create(),
b=vec3.create(),d=vec3.create();return function(h,l,k,g,m){vec3.subtract(c,g,k);vec3.subtract(a,m,k);g=vec3.cross(vec3.create(),c,a);vec3.normalize(g,g);if(0<vec3.dot(g,l))return null;m=vec3.dot(g,vec3.subtract(d,k,h))/vec3.dot(g,l);if(0<m){l=vec3.scale(vec3.create(),l,m);vec3.add(l,l,h);vec3.subtract(b,l,k);h=vec3.dot(a,a);k=vec3.dot(a,c);var q=vec3.dot(a,b),r=vec3.dot(c,c),n=vec3.dot(c,b),p=h*r-k*k,r=(r*q-k*n)/p;h=(h*n-k*q)/p;if(0<=r&&0<=h&&1>=r+h)return new HitTest(m,l,g)}return null}}();t.HitTest=
p.HitTest=function(c,a,b){this.t=arguments.length?c:Number.MAX_VALUE;this.hit=a;this.normal=b};HitTest.prototype={mergeWith:function(c){0<c.t&&c.t<this.t&&(this.t=c.t,this.hit=c.hit,this.normal=c.normal)}};t.Raytracer=p.Raytracer=function(c,a){this.viewport=a=a||gl.getViewport();var b=a[0],d=b+a[2],h=a[1],l=h+a[3];this.ray00=vec3.unproject(vec3.create(),vec3.fromValues(b,h,1),c,a);this.ray10=vec3.unproject(vec3.create(),vec3.fromValues(d,h,1),c,a);this.ray01=vec3.unproject(vec3.create(),vec3.fromValues(b,
l,1),c,a);this.ray11=vec3.unproject(vec3.create(),vec3.fromValues(d,l,1),c,a);b=this.eye=vec3.create();vec3.unproject(b,b,c,a);vec3.subtract(this.ray00,this.ray00,b);vec3.subtract(this.ray10,this.ray10,b);vec3.subtract(this.ray01,this.ray01,b);vec3.subtract(this.ray11,this.ray11,b)};Raytracer.prototype.getRayForPixel=function(c,a){c=(c-this.viewport[0])/this.viewport[2];a=1-(a-this.viewport[1])/this.viewport[3];var b=vec3.lerp(vec3.create(),this.ray00,this.ray10,c),d=vec3.lerp(vec3.create(),this.ray01,
this.ray11,c);return vec3.normalize(vec3.create(),vec3.lerp(vec3.create(),b,d,a))};var v=mat4.create();Raytracer.hitTestBox=function(c,a,b,d,h){var l=new Float32Array(30);h&&(h=mat4.invert(v,h),c=mat4.multiplyVec3(l.subarray(3,6),h,c),a=mat4.rotateVec3(l.subarray(6,9),h,a));var k=vec3.subtract(l.subarray(9,12),b,c);vec3.divide(k,k,a);var g=vec3.subtract(l.subarray(12,15),d,c);vec3.divide(g,g,a);h=vec3.min(l.subarray(15,18),k,g);k=vec3.max(l.subarray(18,21),k,g);h=vec3.maxValue(h);k=vec3.minValue(k);
return 0<h&&h<=k?(a=vec3.scale(l.subarray(21,24),a,h),vec3.add(a,c,a),vec3.addValue(l.subarray(24,27),b,1E-6),vec3.subValue(l.subarray(27,30),d,1E-6),new HitTest(h,a,vec3.fromValues((a[0]>d[0])-(a[0]<b[0]),(a[1]>d[1])-(a[1]<b[1]),(a[2]>d[2])-(a[2]<b[2])))):null};Raytracer.hitTestSphere=function(c,a,b,d){var h=vec3.subtract(vec3.create(),c,b),l=vec3.dot(a,a),k=2*vec3.dot(a,h),h=vec3.dot(h,h)-d*d,h=k*k-4*l*h;return 0<h?(l=(-k-Math.sqrt(h))/(2*l),c=vec3.add(vec3.create(),c,vec3.scale(vec3.create(),a,
l)),new HitTest(l,c,vec3.scale(vec3.create(),vec3.subtract(vec3.create(),c,b),1/d))):null};Raytracer.hitTestTriangle=function(c,a,b,d,h){var l=vec3.subtract(vec3.create(),d,b),k=vec3.subtract(vec3.create(),h,b);h=vec3.cross(vec3.create(),l,k);vec3.normalize(h,h);d=vec3.dot(h,vec3.subtract(vec3.create(),b,c))/vec3.dot(h,a);if(0<d){c=vec3.add(vec3.create(),c,vec3.scale(vec3.create(),a,d));var g=vec3.subtract(vec3.create(),c,b);b=vec3.dot(k,k);a=vec3.dot(k,l);var k=vec3.dot(k,g),m=vec3.dot(l,l),l=vec3.dot(l,
g),g=b*m-a*a,m=(m*k-a*l)/g,l=(b*l-a*k)/g;if(0<=m&&0<=l&&1>=m+l)return new HitTest(d,c,h)}return null};Mesh.parseOBJ=function(c,a){a=a||{};for(var b=[],d=[],h=[],l=[],k=[],g=[],m=[],q={},r=0,n=null,p=null,t=0,w=0,v=p=0,y=0,B=0,z=null,D=!1,F=!1,G=!1,J=!1,P=0,N=a.noindex?a.noindex:1E7<c.length?!0:!1,Q=a.flipAxis,L=Q||a.flipNormals,H=null,K=[],R=c.split("\n"),M=R.length,I=0;I<M;++I)if(n=R[I].replace(/[ \t]+/g," ").replace(/\s\s*$/,""),"#"!=n[0]&&""!=n)if(z=n.split(" "),J&&"v"==z[0]&&(J=!1),"v"==z[0])Q?
k.push(-1*parseFloat(z[1]),parseFloat(z[3]),parseFloat(z[2])):k.push(parseFloat(z[1]),parseFloat(z[2]),parseFloat(z[3]));else if("vt"==z[0])g.push(parseFloat(z[1]),parseFloat(z[2]));else if("vn"==z[0])L?m.push(-parseFloat(z[2]),-parseFloat(z[3]),parseFloat(z[1])):m.push(parseFloat(z[1]),parseFloat(z[2]),parseFloat(z[3]));else if("f"==z[0]){if(J=!0,!(4>z.length)){for(var O=[],n=1;n<z.length;++n){if(!(z[n]in q)||N){p=z[n].split("/");if(1==p.length)p=w=t=parseInt(p[0])-1;else if(2==p.length)t=parseInt(p[0])-
1,w=parseInt(p[1])-1,p=-1;else if(3==p.length)t=parseInt(p[0])-1,w=parseInt(p[1])-1,p=parseInt(p[2])-1;else return console.err("Problem parsing: unknown number of values per face"),!1;3<n&&N&&(v=b.length,b.push(b[v-9*(n-3)],b[v-9*(n-3)+1],b[v-9*(n-3)+2]),b.push(b[v-3],b[v-2],b[v-1]),v=d.length,d.push(d[v-6*(n-3)],d[v-6*(n-3)+1]),d.push(d[v-2],d[v-1]),v=h.length,h.push(h[v-9*(n-3)],h[v-9*(n-3)+1],h[v-9*(n-3)+2]),h.push(h[v-3],h[v-2],h[v-1]));B=y=v=0;3*t+2<k.length&&(D=!0,v=k[3*t+0],y=k[3*t+1],B=k[3*
t+2]);b.push(v,y,B);y=v=0;2*w+1<g.length&&(F=!0,v=g[2*w+0],y=g[2*w+1]);d.push(v,y);y=v=0;B=1;-1!=p&&(3*p+2<m.length&&(G=!0,v=m[3*p+0],y=m[3*p+1],B=m[3*p+2]),h.push(v,y,B));N||(q[z[n]]=r++)}N||(t=q[z[n]],O.push(t),P<t&&(P=t))}if(!N)for(n=2;n<O.length;n++)l.push(O[0],O[n-1],O[n])}}else"g"==z[0]||"usemtl"==z[0]?1<z.length&&(null!=H&&(H.length=l.length-H.start,0<H.length&&K.push(H)),H={name:z[1],start:l.length,length:-1,material:""}):"usemtl"==z[0]&&H&&(H.material=z[1]);if(!k.length)return console.error("OBJ doesnt have vertices, maybe the file is not a OBJ"),
null;H&&1<l.length-H.start&&(H.length=l.length-H.start,K.push(H));if((65536<P||N)&&0<l.length){console.log("Deindexing mesh...");k=new Float32Array(3*l.length);g=h&&h.length?new Float32Array(3*l.length):null;m=d&&d.length?new Float32Array(2*l.length):null;for(n=0;n<l.length;n+=1)k.set(b.slice(3*l[n],3*l[n]+3),3*n),g&&g.set(h.slice(3*l[n],3*l[n]+3),3*n),m&&m.set(d.slice(2*l[n],2*l[n]+2),2*n);b=k;g&&(h=g);m&&(d=m);l=null}n={};D&&(n.vertices=new Float32Array(b));G&&0<h.length&&(n.normals=new Float32Array(h));
F&&0<d.length&&(n.coords=new Float32Array(d));l&&0<l.length&&(n.triangles=new Uint16Array(l));b={};1<K.length&&(b.groups=K);n.info=b;K=null;K=Mesh.load(n,null,a.mesh);K.updateBounding();return K};Mesh.parsers.obj=Mesh.parseOBJ.bind(Mesh);Mesh.encoders.obj=function(c,a){var b=c.getBuffer("vertices");if(!b)return null;for(var d="# Generated with liteGL.js by Javi Agenjo\n\n",b=b.data,h=0;h<b.length;h+=3)d+="v "+b[h].toFixed(4)+" "+b[h+1].toFixed(4)+" "+b[h+2].toFixed(4)+"\n";if(h=c.getBuffer("normals"))for(var d=
d+"\n",l=h.data,h=0;h<l.length;h+=3)d+="vn "+l[h].toFixed(4)+" "+l[h+1].toFixed(4)+" "+l[h+2].toFixed(4)+"\n";if(h=c.getBuffer("coords"))for(d+="\n",l=h.data,h=0;h<l.length;h+=2)d+="vt "+l[h].toFixed(4)+" "+l[h+1].toFixed(4)+"  0.0000\n";d+="\ng mesh\n";if(h=c.getIndexBuffer("triangles"))for(b=h.data,h=0;h<b.length;h+=3)d+="f "+(b[h]+1)+"/"+(b[h]+1)+"/"+(b[h]+1)+" "+(b[h+1]+1)+"/"+(b[h+1]+1)+"/"+(b[h+1]+1)+" "+(b[h+2]+1)+"/"+(b[h+2]+1)+"/"+(b[h+2]+1)+"\n";else for(h=0;h<b.length/3;h+=3)d+="f "+(h+
1)+"/"+(h+1)+"/"+(h+1)+" "+(h+2)+"/"+(h+2)+"/"+(h+2)+" "+(h+3)+"/"+(h+3)+"/"+(h+3)+"\n";return d}})("undefined"!=typeof window?window:"undefined"!=typeof self?self:global);var SIMPL3=function(){var t=mat4.create(),G=[],p,J,D,B,F,y,w=function(e,c){D.position=e;D.target=c};_rotateModel=function(e,c){switch(c){case 0:mat4.rotateX(t,t,e);break;case 1:mat4.rotateY(t,t,e);break;case 2:mat4.rotateZ(t,t,e)}};var v=function(){y=f();D=new SIMPL3.Camera;F=new SIMPL3.cameraControls(D,J);gl.enable(gl.DEPTH_TEST);gl.enable(gl.CULL_FACE);p.hasOwnProperty("cull_face")&&0==p.cull_face&&gl.disable(gl.CULL_FACE);gl.ondraw=function(){gl.viewport(0,0,gl.canvas.width,gl.canvas.height);gl.clear(gl.DEPTH_BUFFER_BIT|
gl.COLOR_BUFFER_BIT);for(i in G){var e=G[i];e.ready&&e.draw(t,D.view,D.projection,B)}};gl.onupdate=function(e){F.update();for(i in G)G[i].update&&G[i].update(e)};gl.onresize=function(e){var c=document.getElementById(J);e=c.clientWidth;c=c.clientHeight;if(gl.canvas.width!=e||gl.canvas.height!=c)gl.canvas.width=e,gl.canvas.height=c,D.projection=mat4.perspective(mat4.create(),D.fov*DEG2RAD,gl.canvas.width/gl.canvas.height,.1,1E4)};window.addEventListener("resize",gl.onresize)},f=function(){var e=document.getElementById(J),
c=GL.create({width:e.clientWidth,height:e.clientHeight});c.animate();e.appendChild(c.canvas);c.clearColor(0,0,0,1);c.enable(c.DEPTH_TEST);c.enable(c.CULL_FACE);c.cullFace(c.BACK);c.getExtension("OES_element_index_uint");return c};return{objects:G,init:function(e,c){p=c||{};J=e;v();w([0,0,5],[0,0,0]);B=[10,10,10]},setCamera:w,setLight:function(e){B=e},rotateModel:_rotateModel,gl:y}}();SIMPL3.Axis={X:0,Y:1,Z:2};
SIMPL3.Camera=function(t){this.position=t?vec3.set(vec3.create(),t[0],t[1],t[2]):vec3.create();this.target=vec3.create();this.initialAngle=Math.PI;this.fov=45;this.view=mat4.create();this.projection=mat4.perspective(mat4.create(),this.fov*DEG2RAD,gl.canvas.width/gl.canvas.height,.1,1E4);this.update=function(){mat4.lookAt(this.view,this.position,this.target,[0,1,0])}};
SIMPL3.cameraControls=function(t,G){function p(d){d.preventDefault();var h=q.domElement;m===g.ROTATE?(vec2.set(y,d.clientX,d.clientY),vec2.subtract(w,y,F),q.rotateLeft(2*Math.PI*w[0]/h.clientWidth*q.rotateSpeed),q.rotateUp(2*Math.PI*w[1]/h.clientHeight*q.rotateSpeed),vec3.copy(F,y)):m===g.DOLLY?(vec2.set(a,d.clientX,d.clientY),vec2.subtract(b,a,c),0<b[1]?q.dollyIn():0>b[1]&&q.dollyOut(),vec2.copy(c,a)):m===g.PAN&&(vec2.set(f,d.clientX,d.clientY),vec2.subtract(e,f,v),q.pan(e),vec2.copy(v,f));m!==g.NONE&&
q.update()}function J(){document.removeEventListener("mousemove",p,!1);document.removeEventListener("mouseup",J,!1);m=g.NONE}function D(a){if(m===g.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?q.dollyOut():0>b&&q.dollyIn();q.update()}}this.camera=t;this.domElement=document.getElementById(G);this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};this.rotateSpeed=1;this.phiDelta=this.thetaDelta=
0;this.minPolarAngle=5*DEG2RAD;this.maxPolarAngle=Math.PI-5*DEG2RAD;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.autoRotate=!1;this.autoRotateSpeed=2;this.dollySpeed=1;var B=vec3.create(),F=vec2.create(),y=vec2.create(),w=vec2.create(),v=vec2.create(),f=vec2.create(),e=vec2.create();vec3.create();var B=vec3.create(),c=vec2.create(),a=vec2.create(),b=vec2.create(),d,h,l=1,k=vec3.create(),g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},m=g.NONE,q=this;
this.rotateLeft=function(a){void 0===a&&(a=2*Math.PI/60/60*q.autoRotateSpeed);q.thetaDelta-=a};this.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*q.autoRotateSpeed);q.phiDelta-=a};this.panLeft=function(a){var b=this.camera.view,b=vec3.set(vec3.create(),b[0],b[4],b[8]);vec3.scale(b,b,-a);vec3.add(k,k,b)};this.panUp=function(a){var b=this.camera.view,b=vec3.set(vec3.create(),b[1],b[5],b[9]);vec3.scale(b,b,a);vec3.add(k,k,b)};this.pan=function(a){var b=q.domElement,c=vec3.sub(vec3.create(),q.camera.position,
q.camera.target),c=vec3.length(c);q.panLeft(2*a[0]*c/b.clientHeight);q.panUp(2*a[1]*c/b.clientHeight)};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,q.dollySpeed));l/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,q.dollySpeed));l*=a};this.update=function(){B=vec3.subtract(vec3.create(),this.camera.position,this.camera.target);d=Math.atan2(B[0],B[2]);h=Math.atan2(Math.sqrt(B[0]*B[0]+B[2]*B[2]),B[1]);d+=this.thetaDelta;h+=this.phiDelta;d=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,
d));h=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,h));var a=vec3.length(B)*l;vec3.add(this.camera.target,this.camera.target,k);vec3.set(B,a*Math.sin(h)*Math.sin(d),a*Math.cos(h),a*Math.sin(h)*Math.cos(d));vec3.add(this.camera.position,this.camera.target,B);this.distanceDelta=this.thetaDelta=this.phiDelta=0;l=1;vec3.set(k,0,0,0);this.camera.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){a.preventDefault();
a.button===q.mouseButtons.ORBIT?(m=g.ROTATE,vec2.set(F,a.clientX,a.clientY)):a.button===q.mouseButtons.ZOOM?(m=g.DOLLY,vec2.set(c,a.clientX,a.clientY)):a.button===q.mouseButtons.PAN&&(m=g.PAN,vec2.set(v,a.clientX,a.clientY));m!==g.NONE&&(document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",J,!1))},!1);this.domElement.addEventListener("mousewheel",D,!1);this.domElement.addEventListener("DOMMouseScroll",D,!1);this.domElement.addEventListener("touchstart",function(a){switch(a.touches.length){case 1:m=
g.TOUCH_ROTATE;vec2.set(F,a.touches[0].pageX,a.touches[0].pageY);break;case 2:m=g.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;vec2.set(c,0,Math.sqrt(b*b+a*a));console.log("start");break;case 3:m=g.TOUCH_PAN;vec2.set(v,a.touches[0].pageX,a.touches[0].pageY);break;default:m=g.NONE}},!1);this.domElement.addEventListener("touchend",function(){m=g.NONE},!1);this.domElement.addEventListener("touchmove",function(d){d.preventDefault();d.stopPropagation();
var h=q.domElement===document?q.domElement.body:q.domElement;switch(d.touches.length){case 1:if(m!==g.TOUCH_ROTATE)break;vec2.set(y,d.touches[0].pageX,d.touches[0].pageY);vec2.sub(w,y,F);q.rotateLeft(2*Math.PI*w[0]/h.clientWidth*q.rotateSpeed);q.rotateUp(2*Math.PI*w[1]/h.clientHeight*q.rotateSpeed);vec2.copy(F,y);q.update();break;case 2:if(m!==g.TOUCH_DOLLY)break;h=d.touches[0].pageX-d.touches[1].pageX;d=d.touches[0].pageY-d.touches[1].pageY;vec2.set(a,0,Math.sqrt(h*h+d*d));vec2.sub(b,a,c);0<b[1]?
q.dollyOut():0>b[1]&&q.dollyIn();vec2.copy(c,a);q.update();break;case 3:if(m!==g.TOUCH_PAN)break;vec2.set(f,d.touches[0].pageX,d.touches[0].pageY);vec2.sub(e,f,v);q.pan(e);vec2.copy(v,f);q.update();break;default:m=g.NONE}},!1);window.addEventListener("keydown",function(a){},!1)};function inheritPrototype(t,G){var p=Object.create(G.prototype);p.constructor=t;t.prototype=p};